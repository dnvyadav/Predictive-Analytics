<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>



















    
    
    
    

  <div class="border-box-sizing">
    <div class="container">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">pwd</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[1]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>u&#39;C:\\Users\\ndokku&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">cd</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">ndokku</span>\<span class="n">Desktop</span>\<span class="n">ECT</span><span class="o">-</span><span class="mi">584</span> <span class="n">Final</span> <span class="n">Project</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>C:\Users\ndokku\Desktop\ECT-584 Final Project
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="c1"># overwrite ipython defaults</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;17344A&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;17344A&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>

<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.lda</span> <span class="kn">import</span> <span class="n">LDA</span>
<span class="kn">from</span> <span class="nn">sklearn.qda</span> <span class="kn">import</span> <span class="n">QDA</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Loading the data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>types of data:
Yelp reviews, business information, users, tips, and check-ins</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># Yelp_academic_datasets appear as a single JSON object per line in the file.</span>
<span class="c1"># Write the first line of the review file to look at the structure.</span>
<span class="o">!</span> head -n <span class="m">1</span> yelp_academic_dataset_review.json
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{&quot;votes&quot;: {&quot;funny&quot;: 0, &quot;useful&quot;: 0, &quot;cool&quot;: 0}, &quot;user_id&quot;: &quot;PUFPaY9KxDAcGqfsorJp3Q&quot;, &quot;review_id&quot;: &quot;Ya85v4eqdd6k9Od8HbQjyA&quot;, &quot;stars&quot;: 4, &quot;date&quot;: &quot;2012-08-01&quot;, &quot;text&quot;: &quot;Mr Hoagie is an institution. Walking in, it does seem like a throwback to 30 years ago, old fashioned menu board, booths out of the 70s, and a large selection of food. Their speciality is the Italian Hoagie, and it is voted the best in the area year after year. I usually order the burger, while the patties are obviously cooked from frozen, all of the other ingredients are very fresh. Overall, its a good alternative to Subway, which is down the road.&quot;, &quot;type&quot;: &quot;review&quot;, &quot;business_id&quot;: &quot;5UmKMjUEUNdYWqANhGckJw&quot;}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span> head -n <span class="m">1</span> yelp_academic_dataset_business.json
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{&quot;business_id&quot;: &quot;5UmKMjUEUNdYWqANhGckJw&quot;, &quot;full_address&quot;: &quot;4734 Lebanon Church Rd\nDravosburg, PA 15034&quot;, &quot;hours&quot;: {&quot;Friday&quot;: {&quot;close&quot;: &quot;21:00&quot;, &quot;open&quot;: &quot;11:00&quot;}, &quot;Tuesday&quot;: {&quot;close&quot;: &quot;21:00&quot;, &quot;open&quot;: &quot;11:00&quot;}, &quot;Thursday&quot;: {&quot;close&quot;: &quot;21:00&quot;, &quot;open&quot;: &quot;11:00&quot;}, &quot;Wednesday&quot;: {&quot;close&quot;: &quot;21:00&quot;, &quot;open&quot;: &quot;11:00&quot;}, &quot;Monday&quot;: {&quot;close&quot;: &quot;21:00&quot;, &quot;open&quot;: &quot;11:00&quot;}}, &quot;open&quot;: true, &quot;categories&quot;: [&quot;Fast Food&quot;, &quot;Restaurants&quot;], &quot;city&quot;: &quot;Dravosburg&quot;, &quot;review_count&quot;: 4, &quot;name&quot;: &quot;Mr Hoagie&quot;, &quot;neighborhoods&quot;: [], &quot;longitude&quot;: -79.9007057, &quot;state&quot;: &quot;PA&quot;, &quot;stars&quot;: 4.5, &quot;latitude&quot;: 40.3543266, &quot;attributes&quot;: {&quot;Take-out&quot;: true, &quot;Drive-Thru&quot;: false, &quot;Good For&quot;: {&quot;dessert&quot;: false, &quot;latenight&quot;: false, &quot;lunch&quot;: false, &quot;dinner&quot;: false, &quot;brunch&quot;: false, &quot;breakfast&quot;: false}, &quot;Caters&quot;: false, &quot;Noise Level&quot;: &quot;average&quot;, &quot;Takes Reservations&quot;: false, &quot;Delivery&quot;: false, &quot;Ambience&quot;: {&quot;romantic&quot;: false, &quot;intimate&quot;: false, &quot;classy&quot;: false, &quot;hipster&quot;: false, &quot;divey&quot;: false, &quot;touristy&quot;: false, &quot;trendy&quot;: false, &quot;upscale&quot;: false, &quot;casual&quot;: false}, &quot;Parking&quot;: {&quot;garage&quot;: false, &quot;street&quot;: false, &quot;validated&quot;: false, &quot;lot&quot;: false, &quot;valet&quot;: false}, &quot;Has TV&quot;: false, &quot;Outdoor Seating&quot;: false, &quot;Attire&quot;: &quot;casual&quot;, &quot;Alcohol&quot;: &quot;none&quot;, &quot;Waiter Service&quot;: false, &quot;Accepts Credit Cards&quot;: true, &quot;Good for Kids&quot;: true, &quot;Good For Groups&quot;: true, &quot;Price Range&quot;: 1}, &quot;type&quot;: &quot;business&quot;}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span> head -n <span class="m">1</span> yelp_academic_dataset_checkin.json
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{&quot;checkin_info&quot;: {&quot;9-5&quot;: 1, &quot;7-5&quot;: 1, &quot;13-3&quot;: 1, &quot;17-6&quot;: 1, &quot;13-0&quot;: 1, &quot;17-3&quot;: 1, &quot;10-0&quot;: 1, &quot;18-4&quot;: 1, &quot;14-6&quot;: 1}, &quot;type&quot;: &quot;checkin&quot;, &quot;business_id&quot;: &quot;cE27W9VPgO88Qxe4ol6y_g&quot;}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span> head -n <span class="m">1</span> yelp_academic_dataset_user.json
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{&quot;yelping_since&quot;: &quot;2004-10&quot;, &quot;votes&quot;: {&quot;funny&quot;: 167, &quot;useful&quot;: 280, &quot;cool&quot;: 245}, &quot;review_count&quot;: 108, &quot;name&quot;: &quot;Russel&quot;, &quot;user_id&quot;: &quot;18kPq7GPye-YQ3LyKyAZPw&quot;, &quot;friends&quot;: [&quot;rpOyqD_893cqmDAtJLbdog&quot;, &quot;4U9kSBLuBDU391x6bxU-YA&quot;, &quot;fHtTaujcyKvXglE33Z5yIw&quot;, &quot;8J4IIYcqBlFch8T90N923A&quot;, &quot;wy6l_zUo7SN0qrvNRWgySw&quot;, &quot;HDQixQ-WZEV0LVPJlIGQeQ&quot;, &quot;T4kuUr_iJiywOPdyM7gTHQ&quot;, &quot;z_5D4XEIlGAPjG3Os9ix5A&quot;, &quot;i63u3SdbrLsP4FxiSKP0Zw&quot;, &quot;pnrGw4ciBXJ6U5QB2m0F5g&quot;, &quot;ytjCBxosVSqCOQ62c4KAxg&quot;, &quot;r5uiIxwJ-I-oHBkNY2Ha3Q&quot;, &quot;niWoSKswEbooJC_M7HMbGw&quot;, &quot;kwoxiKMyoYjB1wTCYAjYRg&quot;, &quot;9A8OuP6XwLwnNb9ov3_Ncw&quot;, &quot;27MmRg8LfbZXNEHkEnKSdA&quot;, &quot;Bn4sJUTtKFZQt0FKHF2Adw&quot;, &quot;uguXfIEpI65jSCH5MgUDgA&quot;, &quot;6VZNGc2h2Bn-uyuEXgOt5g&quot;, &quot;AZ8CTtwr-4sGM2kZqF6qig&quot;, &quot;S742m-AuQicMSLDdErrLZQ&quot;, &quot;uGmQ6ab4iVpWn5m61VFhkQ&quot;, &quot;GJYJX4SujVj3BR8v2F9PDQ&quot;, &quot;3shjifK-vZkIHciyy_KbYA&quot;, &quot;4lc_H2Cf7CO0tCgyA3aSVQ&quot;, &quot;Tunkp_F1R_uFBJQTsDxD4g&quot;, &quot;B9pKfr27czBbCoAIircZdQ&quot;, &quot;pePGMO6EbDpbaZ7D2m6HIg&quot;, &quot;XRM8W6HUoXbrYKR3BCj9Rg&quot;, &quot;8DqIWXsKXOipfduYEfFpNw&quot;, &quot;dvRVX54Z9f7Om51NsTRX1w&quot;, &quot;CM0saLQmk4oAB17UmQTV-g&quot;, &quot;HANb8-8InWnju-XzBQQSBw&quot;, &quot;JuJeZeQJgv7bUreY7a1SlQ&quot;, &quot;2NVVEEYhhoVELdaPILFrDQ&quot;, &quot;e4M9_S-ASmRys3DvKQfotw&quot;, &quot;XA109o963exKgoVGcg9z7w&quot;, &quot;tVAKdax3Jbf24R7OJB99JQ&quot;, &quot;OMWT-Z6OnJLcg44lCuDuhw&quot;, &quot;d82F_FFtowYtjGtxRySehA&quot;, &quot;pW91HUnVz6ssLZ4dY-ztyQ&quot;, &quot;ojQYtstkGXtcryk5I9GTYA&quot;, &quot;4hxVql33ldY_gkf3rG8_3w&quot;, &quot;0arQ82n4mvrc42U8KuoE6g&quot;, &quot;w6Vv-kldGpmvSGqXvTbAdQ&quot;, &quot;NZeCINmoOJ8vsQvYkZAp9w&quot;, &quot;n9ltC5DxMjefffeMfBgcXQ&quot;, &quot;QBj2AL66bEAmK3ULkrn1Gw&quot;, &quot;ayZlWyV1M2k_UWx1dreIDg&quot;, &quot;AG1KRDkIa8QCCPsMnINEOg&quot;, &quot;P-lfV8cdAgEOZJkw2dJpsw&quot;, &quot;7Pef9EA21szXXOPJo6Gb5w&quot;, &quot;YvtRBqCqhSIhGGREqcqnQw&quot;, &quot;8M7I2-s5nQ8LSkuCvN0Xqg&quot;, &quot;-ETxy7f37BBQXhw5zJfkrQ&quot;, &quot;TjPt2hD56jfpmtoa6kVVRg&quot;, &quot;uZgFEPEUIWJMaaqvMlxYoA&quot;, &quot;foIpFZp5EwvUDSnyMKKAnQ&quot;, &quot;YKppbE7ogNmbtVrluxEF4A&quot;, &quot;D7uXj1_0pE_Fa2YeLkOkyw&quot;, &quot;eVV99D3EZvkuswIvIySKiw&quot;, &quot;PhwgVPqpJlxu40AxAOUBbg&quot;, &quot;gWcz4QFTW76q8VtpIlZEHQ&quot;, &quot;wpcoiQNbO5x0xkZwKFVUFw&quot;, &quot;Ot-QjYpIdVsluuxcqidjkA&quot;, &quot;E3C_gEhktux9Ca-Z2fmNTw&quot;, &quot;ClaGLOr72DPJlQhRc9HHyQ&quot;, &quot;sc6wS6YOFIgtN2XuJI8_WQ&quot;, &quot;dD5mA6kwVlBHvrNtX9EyZQ&quot;, &quot;qwvgycPC5u4JZv6DfawPqw&quot;, &quot;As_oVE27fiE-0CbDJwUDiA&quot;, &quot;SuzSrMWoycf4DXL_DMMdNg&quot;, &quot;y0SRKlzVuvj-mbQtbsWx-A&quot;, &quot;qbfQRHLvZk5WSkKY0l_lMw&quot;, &quot;D6A0rn5MIg7AVRrVeouABg&quot;, &quot;KUqpJ9eKREuvlnlitJJRYg&quot;, &quot;gOvKWYXobX_Pgzsz-K8auA&quot;, &quot;xzdZTsR2KKcQfjF4OjJeOw&quot;, &quot;DyfA7aPzRQ81kJnbkuIiJQ&quot;, &quot;tA2suyZG_qWIuNB_HR-YRA&quot;, &quot;R5QmtpSsrQ9mqIxjZIv3uw&quot;, &quot;5T8SdBwiH0jdwatUJ7KFUg&quot;, &quot;1Gfn4nlqPEIvRX4cnctJlg&quot;, &quot;A4_fxqSj4tgYet8OE3jTyA&quot;, &quot;oPD_t6BVpfhvu1-TS4FNzA&quot;, &quot;gn3Y0mWduWrvT1hvu7fv4A&quot;, &quot;NUeLSLukiPPCSK6EVdUo_Q&quot;, &quot;rtrh46NJfksxR4TgljYg9w&quot;, &quot;5zpVMWD-q6nEYapiWrSyXw&quot;, &quot;ooZ7TV6IuxuqbFgnqaoSsQ&quot;, &quot;8phGuOZ0NIfeJiTX-ZDZLA&quot;, &quot;8L1p_zlmAB_uWyaW0QTaCg&quot;, &quot;s7ZSag-bHo0C4fSBDJeBDw&quot;, &quot;5ANDwUyQqsRhEl7QBKRFiw&quot;, &quot;KMGF6KAnPRoOTFVXBy9jtQ&quot;, &quot;aLz2ljnMweZUlvP-q4TayQ&quot;, &quot;6uM5lx0DCX4ctQlebtxraw&quot;, &quot;Hc6agWZ9jGCxsPAqQwlf2w&quot;, &quot;z39ulrgtvEMB2oeokx0-mw&quot;, &quot;wLt28qh-46LFhKOeByWZ0w&quot;, &quot;p4Jg_rO_AsCWZGMd_w8xjw&quot;, &quot;pJppmQyW74ejj8xCa2SHuA&quot;, &quot;hzaqnSxfRYv_Wbp6CMKtQw&quot;, &quot;0QwV8PJk9PJDFaMNw1Fcsw&quot;, &quot;6pC5j-hfP4xLZB2W0Wi1vg&quot;, &quot;8nAj60xsBjcHXLLSs7cPqw&quot;, &quot;NhbV8AbaQiKNzEU11cbxcQ&quot;, &quot;5Szwd1CSepRXwAFH12nPzQ&quot;, &quot;ifD7o8Mi67yNYwgWL5CbKg&quot;, &quot;AaZdXn0I6F5bdIVwGpxdDA&quot;, &quot;YwcacxA7WCB9fryDHDxF8w&quot;, &quot;HBFtzjRarXxDH8xZRSNsPA&quot;, &quot;zi0kxtr5gq0Flg7jYdIlMA&quot;, &quot;oWEdmTYl13VHh1A_Mkhh2g&quot;, &quot;n1GSQ7VT9sTL5MlCWolbNw&quot;, &quot;PO8XNxGUizzzKGHmn24fQQ&quot;, &quot;JTRxzA1AZ8Zfwj7FpH2CnA&quot;, &quot;AixLPxra_4HirfchjPkiWA&quot;, &quot;xOK3i0wgmkpGu54BuIcwQA&quot;, &quot;F9T6m1YdRFreyKDufcyoOQ&quot;, &quot;-cscgA-lVPipPwEX4RmcgQ&quot;, &quot;ACLuEsNHV7lfq1O7CHuFaA&quot;, &quot;UyOtYjnavsr-Dtjo6Xy91g&quot;, &quot;J11gYVC1u9S5jqEg3oh-gQ&quot;, &quot;9LZP7Ll7N9zkuWfA5DUAYw&quot;, &quot;SbM1m5nejHDD1pJePsar9g&quot;, &quot;wF7_-zf7R8Rri7Kq-a0tlw&quot;, &quot;B5o7JC4iRJ7bKPRnoYEIHg&quot;, &quot;SAPz30NHFJ95SBlvz5cTqw&quot;, &quot;fzkO1lGkx8MHhT8S4Rbg3w&quot;, &quot;tlSSQwfHYJany7wPoTH46A&quot;, &quot;2VfhMrTJ9bZ0O4PZmRmxKA&quot;, &quot;odeoZZHRQp6TkeoEQk3eeA&quot;, &quot;2XCsVpAMsGUykrM-BBFEXA&quot;, &quot;qVePixO2kuK0Dr03upCWFg&quot;, &quot;D9CIW04wrcQzZNdCEoASAg&quot;, &quot;G-iuXcbJnX3sA3lhB6nFhQ&quot;, &quot;3utEqyNzFcxH8E8pm7ByPA&quot;, &quot;T5TZfn9_9X-LTbRtaMAgUw&quot;, &quot;fczQCSmaWF78toLEmb0Zsw&quot;, &quot;Hyhmpb3UnbjtSEXvgviCow&quot;, &quot;FI-Fjxr3fUBx2q7icnqcfA&quot;, &quot;S8ZY1HEDoECqKrIUY34JOg&quot;, &quot;3JtdBvnY6Wzp22gt5zFwDg&quot;, &quot;470dZswdTHz5aaGPvIYNpg&quot;, &quot;JT5kM6wRwh7cNt8IAuX_sw&quot;, &quot;r7V9Nhes-Eg-lH0cqfpFFw&quot;, &quot;2m3lE8p8T2nFRDxIUaRXew&quot;, &quot;bZFRqP7s0Vszxeu8_IwYow&quot;, &quot;snd45oedwXxF9tsHUX_6dg&quot;, &quot;8jEK8gxHYg9w6sINujO0MQ&quot;, &quot;LTWY2Ee-SYu8ItVOebD3CQ&quot;, &quot;7zpDhrRZRTGCkAh3SHbEww&quot;, &quot;NSg7k2UFt_HqM2mvsw-n0w&quot;, &quot;egdj4-wXAzYzT5bmTAHYqQ&quot;, &quot;wxhf-RSExCGECZuz_iVV7w&quot;, &quot;C6IOtaaYdLIT5fWd7ZYIuA&quot;, &quot;jntSRFnN_O7QfFzZo24rvA&quot;, &quot;yfQwWLYtqwHKiky1hiTBew&quot;, &quot;WZgoM8UuzxjZf1AaWx3qZQ&quot;, &quot;cNj8rheuldPDX9zF6q2yaA&quot;, &quot;OqOCMRpVNvvdPDMhoG_DCA&quot;, &quot;9ZonzxW0DAqIUO_5tDqZig&quot;, &quot;rLQNlHnIKdtoqoU77CbEUQ&quot;, &quot;LbgQK5B_5IkN77FgRJHhrg&quot;, &quot;it23EnutJ6fOjeYQBDKJug&quot;, &quot;1XWzXgFvcu5pU2wj1ONQ_Q&quot;, &quot;92j9xiUMOsM3HviIGoR8Yg&quot;, &quot;AP6udBIStvWLY0T5rS_24A&quot;, &quot;G_PCzMHcOLoMyyEsxW1DFQ&quot;, &quot;ZuQ87LQYWRw3AHj-jEiQ1Q&quot;, &quot;zdutsCEMdvc0B8s3_XN3nQ&quot;, &quot;fRbbPPUdMCmL9o39yshi2g&quot;, &quot;pjgE1d3csesAkgn6rQI_RQ&quot;, &quot;C7nUczj6n0ouxWqp1I7cNQ&quot;, &quot;D8EE4gbAiXS3DF_HNRJfAw&quot;, &quot;Milv8k4zZsoCaNFZugKtJw&quot;, &quot;GALRNo-AbcAHxEdmqKl--w&quot;, &quot;XOe-I25-W_FnbYfQyafylw&quot;, &quot;kuP0AMnSGgkLfNSt0wOAgA&quot;, &quot;EwMgdjuPXLAuxxu3IOUyKA&quot;, &quot;Mx-vxv_V-SQCe76w4RmUfA&quot;, &quot;6xxVdJBdMREj1fCqjm6UtA&quot;, &quot;m61SjiXAIlOY1qAXOHEk4Q&quot;, &quot;R4sYowLqQQEpxWjQbqaFvg&quot;, &quot;OCkge7lzOw33bqMs1244Yw&quot;, &quot;rjJJ8QQg-eqb7mgMxArgBA&quot;, &quot;T_wjLgPOPXry7Bea4MzoVQ&quot;, &quot;hBwbBaBqofCgvkJ3PatuVw&quot;, &quot;epTMlecM8SZNjDhBsd64Jg&quot;, &quot;PUMROYfbVgKypcfJNxs1mw&quot;, &quot;82ZqgHOfUMV1xtpG2KfisA&quot;, &quot;IN2HcBun5PpyfQK8OC68iw&quot;, &quot;yQZL8MTulNh3d3de-N0oug&quot;, &quot;nZFcWvgPU8T4JCjOVvJU8Q&quot;, &quot;jIuc3nM9R0KWX3v-8OyLsQ&quot;, &quot;F1oGgK3NtTYnyRMxupiiuA&quot;, &quot;nGYaT5sAuqKkd48dqX_2Kw&quot;, &quot;NzP9OoNP8vBMRUSs0UXBNw&quot;, &quot;ZTs-go-xYRQOp3PSw_XGDg&quot;, &quot;gc4rNAgbGydNMAPJ85FZag&quot;, &quot;KYuljD4Tovti3J1pdBnT4g&quot;], &quot;fans&quot;: 70, &quot;average_stars&quot;: 4.14, &quot;type&quot;: &quot;user&quot;, &quot;compliments&quot;: {&quot;profile&quot;: 8, &quot;cute&quot;: 15, &quot;funny&quot;: 11, &quot;plain&quot;: 25, &quot;writer&quot;: 9, &quot;note&quot;: 20, &quot;photos&quot;: 14, &quot;hot&quot;: 48, &quot;cool&quot;: 78, &quot;more&quot;: 3}, &quot;elite&quot;: [2005, 2006]}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span> head -n <span class="m">1</span> yelp_academic_dataset_tip.json
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>{&quot;user_id&quot;: &quot;-6rEfobYjMxpUWLNxszaxQ&quot;, &quot;text&quot;: &quot;Don&#39;t waste your time.&quot;, &quot;business_id&quot;: &quot;cE27W9VPgO88Qxe4ol6y_g&quot;, &quot;likes&quot;: 0, &quot;date&quot;: &quot;2013-04-18&quot;, &quot;type&quot;: &quot;tip&quot;}
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The reviews dataset
This is the dataset that includes the actual text reviews and the star ratings</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">reviews</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_review.json&#39;</span><span class="p">)]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[16]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>2225213</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># convert to pandas data frame</span>
<span class="n">reviews</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>
<span class="n">reviews</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[17]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(2225213, 8)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">reviews</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[24]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>business_id</th>
      <th>date</th>
      <th>review_id</th>
      <th>stars</th>
      <th>text</th>
      <th>type</th>
      <th>user_id</th>
      <th>votes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5UmKMjUEUNdYWqANhGckJw</td>
      <td>2012-08-01</td>
      <td>Ya85v4eqdd6k9Od8HbQjyA</td>
      <td>4</td>
      <td>Mr Hoagie is an institution. Walking in, it do...</td>
      <td>review</td>
      <td>PUFPaY9KxDAcGqfsorJp3Q</td>
      <td>{u&#39;funny&#39;: 0, u&#39;useful&#39;: 0, u&#39;cool&#39;: 0}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5UmKMjUEUNdYWqANhGckJw</td>
      <td>2014-02-13</td>
      <td>KPvLNJ21_4wbYNctrOwWdQ</td>
      <td>5</td>
      <td>Excellent food. Superb customer service. I mis...</td>
      <td>review</td>
      <td>Iu6AxdBYGR4A0wspR9BYHA</td>
      <td>{u&#39;funny&#39;: 0, u&#39;useful&#39;: 0, u&#39;cool&#39;: 0}</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5UmKMjUEUNdYWqANhGckJw</td>
      <td>2015-10-31</td>
      <td>fFSoGV46Yxuwbr3fHNuZig</td>
      <td>5</td>
      <td>Yes this place is a little out dated and not o...</td>
      <td>review</td>
      <td>auESFwWvW42h6alXgFxAXQ</td>
      <td>{u&#39;funny&#39;: 0, u&#39;useful&#39;: 0, u&#39;cool&#39;: 0}</td>
    </tr>
    <tr>
      <th>3</th>
      <td>UsFtqoBl7naz8AVUBZMjQQ</td>
      <td>2013-11-08</td>
      <td>Di3exaUCFNw1V4kSNW5pgA</td>
      <td>5</td>
      <td>All the food is great here. But the best thing...</td>
      <td>review</td>
      <td>uK8tzraOp4M5u3uYrqIBXg</td>
      <td>{u&#39;funny&#39;: 0, u&#39;useful&#39;: 0, u&#39;cool&#39;: 0}</td>
    </tr>
    <tr>
      <th>4</th>
      <td>UsFtqoBl7naz8AVUBZMjQQ</td>
      <td>2014-03-29</td>
      <td>0Lua2-PbqEQMjD9r89-asw</td>
      <td>3</td>
      <td>We checked this place out this past Monday for...</td>
      <td>review</td>
      <td>I_47G-R2_egp7ME5u_ltew</td>
      <td>{u&#39;funny&#39;: 0, u&#39;useful&#39;: 0, u&#39;cool&#39;: 0}</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># analyze distribution of the stars</span>
<span class="n">reviews</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;stars&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[25]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1ec845828&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># analyze the number of reviews and ratings per year</span>
<span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">reviews</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;stars&#39;</span><span class="p">],</span> <span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[26]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x23470b438&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">star_by_review_count</span> <span class="o">=</span> <span class="n">reviews</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;business_id&#39;</span><span class="p">)[</span><span class="s1">&#39;stars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;num_of_reviews&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span> <span class="s1">&#39;avg_stars&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">})</span>
<span class="n">star_by_review_count</span><span class="p">[</span><span class="s1">&#39;log_num_of_reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">star_by_review_count</span><span class="p">[</span><span class="s1">&#39;num_of_reviews&#39;</span><span class="p">])</span>

<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="s1">&#39;num_of_reviews&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_stars&#39;</span><span class="p">,</span> <span class="n">star_by_review_count</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;reg&#39;</span><span class="p">,</span> <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
              <span class="n">color</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="s1">&#39;log_num_of_reviews&#39;</span><span class="p">,</span> <span class="s1">&#39;avg_stars&#39;</span><span class="p">,</span> <span class="n">star_by_review_count</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;reg&#39;</span><span class="p">,</span> <span class="n">xlim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
              <span class="n">color</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[27]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;seaborn.axisgrid.JointGrid at 0xc346d30&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There seems to be an upward trend using the raw review count, but there is too much noise in the lower end to apply it reliably. But When applying the log transformation, the trend disappears.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The business dataset</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">business</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_business.json&#39;</span><span class="p">)]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">business</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[28]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>77445</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">business</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">business</span><span class="p">)</span>
<span class="n">business</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[29]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(77445, 15)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">business</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[30]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>attributes</th>
      <th>business_id</th>
      <th>categories</th>
      <th>city</th>
      <th>full_address</th>
      <th>hours</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>name</th>
      <th>neighborhoods</th>
      <th>open</th>
      <th>review_count</th>
      <th>stars</th>
      <th>state</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>{u&#39;Take-out&#39;: True, u&#39;Drive-Thru&#39;: False, u&#39;Ou...</td>
      <td>5UmKMjUEUNdYWqANhGckJw</td>
      <td>[Fast Food, Restaurants]</td>
      <td>Dravosburg</td>
      <td>4734 Lebanon Church Rd\nDravosburg, PA 15034</td>
      <td>{u&#39;Tuesday&#39;: {u&#39;close&#39;: u&#39;21:00&#39;, u&#39;open&#39;: u&#39;1...</td>
      <td>40.354327</td>
      <td>-79.900706</td>
      <td>Mr Hoagie</td>
      <td>[]</td>
      <td>True</td>
      <td>4</td>
      <td>4.5</td>
      <td>PA</td>
      <td>business</td>
    </tr>
    <tr>
      <th>1</th>
      <td>{u&#39;Happy Hour&#39;: True, u&#39;Accepts Credit Cards&#39;:...</td>
      <td>UsFtqoBl7naz8AVUBZMjQQ</td>
      <td>[Nightlife]</td>
      <td>Dravosburg</td>
      <td>202 McClure St\nDravosburg, PA 15034</td>
      <td>{}</td>
      <td>40.350553</td>
      <td>-79.886814</td>
      <td>Clancy&#39;s Pub</td>
      <td>[]</td>
      <td>True</td>
      <td>4</td>
      <td>3.5</td>
      <td>PA</td>
      <td>business</td>
    </tr>
    <tr>
      <th>2</th>
      <td>{}</td>
      <td>3eu6MEFlq2Dg7bQh8QbdOg</td>
      <td>[Auto Repair, Automotive]</td>
      <td>Dravosburg</td>
      <td>1 Ravine St\nDravosburg, PA 15034</td>
      <td>{}</td>
      <td>40.350956</td>
      <td>-79.889059</td>
      <td>Joe Cislo&#39;s Auto</td>
      <td>[]</td>
      <td>True</td>
      <td>3</td>
      <td>5.0</td>
      <td>PA</td>
      <td>business</td>
    </tr>
    <tr>
      <th>3</th>
      <td>{u&#39;Good for Kids&#39;: True}</td>
      <td>cE27W9VPgO88Qxe4ol6y_g</td>
      <td>[Active Life, Mini Golf, Golf]</td>
      <td>Bethel Park</td>
      <td>1530 Hamilton Rd\nBethel Park, PA 15234</td>
      <td>{}</td>
      <td>40.354115</td>
      <td>-80.014660</td>
      <td>Cool Springs Golf Center</td>
      <td>[]</td>
      <td>False</td>
      <td>5</td>
      <td>2.5</td>
      <td>PA</td>
      <td>business</td>
    </tr>
    <tr>
      <th>4</th>
      <td>{u&#39;Accepts Credit Cards&#39;: False, u&#39;Price Range...</td>
      <td>HZdLhv6COCleJMo7nPl-RA</td>
      <td>[Shopping, Home Services, Internet Service Pro...</td>
      <td>Pittsburgh</td>
      <td>301 South Hills Village\nPittsburgh, PA 15241</td>
      <td>{u&#39;Monday&#39;: {u&#39;close&#39;: u&#39;21:00&#39;, u&#39;open&#39;: u&#39;10...</td>
      <td>40.357620</td>
      <td>-80.059980</td>
      <td>Verizon</td>
      <td>[]</td>
      <td>True</td>
      <td>5</td>
      <td>2.5</td>
      <td>PA</td>
      <td>business</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>comparing the Business IDs from the two dataframes</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">print</span> <span class="s1">&#39;the number of unique business_ids from the reviews dataset:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]))</span>
<span class="k">print</span> <span class="s1">&#39;the number of unique business_ids from the business dataset:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">business</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>the number of unique business_ids from the reviews dataset: 77079
the number of unique business_ids from the business dataset: 77445
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">print</span> <span class="s1">&#39;the number of business_ids the two datasets have in common:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">business</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>the number of business_ids the two datasets have in common: 77079
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">category_len</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">business</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]]</span>
<span class="k">print</span> <span class="s1">&#39;the number of blank business categories:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">category_len</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>the number of blank business categories: 260
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">bid_0</span> <span class="o">=</span> <span class="n">business</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">category_len</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s1">&#39;the number of &quot;blank&quot; business listings included in the reviews dataset:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">bid_0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;business_id&#39;</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>the number of &quot;blank&quot; business listings included in the reviews dataset: 258
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">business</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">category_len</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="n">cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># count the frequencies of all categories</span>
<span class="n">categories_all</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">business</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">],</span> <span class="p">[])</span>
<span class="n">categories_all_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">categories_all</span><span class="p">)</span>

<span class="c1"># for each business listing, find the category description that is most common to all</span>
<span class="n">categories</span> <span class="o">=</span> <span class="n">business</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span>
<span class="n">categories_count</span> <span class="o">=</span> <span class="p">[[</span><span class="n">categories_all_count</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">category</span><span class="p">]</span> <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">]</span>

<span class="n">most_common_ix</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="k">for</span> <span class="n">counts</span> <span class="ow">in</span> <span class="n">categories_count</span><span class="p">]</span>
<span class="n">most_common_categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">categories</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">most_common_ix</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">))]</span>

<span class="c1"># count again</span>
<span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">most_common_categories</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[36]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>Restaurants                     25071
Shopping                        11206
Food                             6443
Beauty &amp; Spas                    5827
Home Services                    4464
Health &amp; Medical                 4362
Automotive                       3838
Active Life                      2680
Local Services                   2661
Nightlife                        2396
Event Planning &amp; Services        2281
Pets                             1452
Arts &amp; Entertainment             1114
Hotels &amp; Travel                   926
Financial Services                684
Professional Services             533
Education                         435
Public Services &amp; Government      380
NA                                260
Religious Organizations           211
Local Flavor                      125
Mass Media                         96
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># better, but there&#39;s still categories that can be grouped together (based on subjective reviews)</span>
<span class="n">category_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Food&#39;</span><span class="p">:</span> <span class="s1">&#39;Restaurants&#39;</span><span class="p">,</span> <span class="s1">&#39;Local Flavor&#39;</span><span class="p">:</span> <span class="s1">&#39;Arts &amp; Entertainment&#39;</span><span class="p">,</span> <span class="s1">&#39;Mass Media&#39;</span><span class="p">:</span> <span class="s1">&#39;Arts &amp; Entertainment&#39;</span><span class="p">}</span>
<span class="n">most_common_categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">category_map</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_map</span> <span class="k">else</span> <span class="n">category</span>
                          <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">most_common_categories</span><span class="p">]</span>
<span class="n">business</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">most_common_categories</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">business</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">attr</span><span class="p">[</span><span class="s1">&#39;Price Range&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;Price Range&#39;</span> <span class="ow">in</span> <span class="n">attr</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">business</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">business</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span> <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AZ&#39;</span><span class="p">,</span> <span class="s1">&#39;NV&#39;</span><span class="p">,</span> <span class="s1">&#39;WI&#39;</span><span class="p">,</span> <span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;EDH&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;Others&#39;</span>
                     <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">business</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># select fields to save</span>
<span class="n">business</span> <span class="o">=</span> <span class="n">business</span><span class="p">[[</span><span class="s1">&#39;business_id&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">]]</span>
<span class="n">business</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;business.pkl&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Merge reviews and business datasets</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">reviews</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span> <span class="n">business</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;business_id&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># analyze the number of reviews and ratings per category</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;stars&#39;</span><span class="p">],</span> <span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">],</span> <span class="n">order</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># rotate labels for the boxplot</span>
<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># analyze the number of reviews and ratings per price level</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">reviews</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;stars&#39;</span><span class="p">],</span> <span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[43]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x244bf2048&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># finally, the number of reviews and ratings per state</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;stars&#39;</span><span class="p">],</span> <span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">],</span> <span class="n">order</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">reviews</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[44]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2449a7da0&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>

<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.lda</span> <span class="kn">import</span> <span class="n">LDA</span>
<span class="kn">from</span> <span class="nn">sklearn.qda</span> <span class="kn">import</span> <span class="n">QDA</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">simplejson</span> <span class="kn">as</span> <span class="nn">json</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># Converting the Yelp Dataset from json format to csv.</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">readFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Read in the json dataset file and return a list of python dicts.&quot;&quot;&quot;</span>
     <span class="n">file_records</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="n">column_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
             <span class="n">line_records</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
             <span class="n">column_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                     <span class="nb">set</span><span class="p">(</span><span class="n">get_column_names</span><span class="p">(</span><span class="n">line_records</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                     <span class="p">)</span>
             <span class="n">file_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_records</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span>

<span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="n">line_records</span><span class="p">,</span> <span class="n">parent_key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
     <span class="n">column_names</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">line_records</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
         <span class="n">column_name</span> <span class="o">=</span> <span class="s2">&quot;{0}.{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent_key</span> <span class="k">else</span> <span class="n">k</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">MutableMapping</span><span class="p">):</span>
             <span class="n">column_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                     <span class="n">get_column_names</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                     <span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
             <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">column_name</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
     <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_nested_value</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
     <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
             <span class="k">return</span> <span class="bp">None</span>
         <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
     <span class="n">base_key</span><span class="p">,</span> <span class="n">sub_key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">base_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
         <span class="k">return</span> <span class="bp">None</span>
     <span class="n">sub_dict</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">base_key</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">get_nested_value</span><span class="p">(</span><span class="n">sub_dict</span><span class="p">,</span> <span class="n">sub_key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_row</span><span class="p">(</span><span class="n">line_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a csv compatible row given column names and a dict.&quot;&quot;&quot;</span>
     <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
        <span class="n">line_value</span> <span class="o">=</span> <span class="n">get_nested_value</span><span class="p">(</span>
                         <span class="n">line_records</span><span class="p">,</span>
                         <span class="n">column_name</span><span class="p">,</span>
                         <span class="p">)</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line_value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
             <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span>
         <span class="k">elif</span> <span class="n">line_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
             <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_value</span><span class="p">))</span>
         <span class="k">else</span><span class="p">:</span>
             <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">writeFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Create and write a csv file given file_contents of our json dataset file and column names.&quot;&quot;&quot;</span>
     <span class="n">csv_file</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;wb+&#39;</span><span class="p">))</span>
     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
         <span class="n">csv_file</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>
         <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
         <span class="k">for</span> <span class="n">line_records</span> <span class="ow">in</span> <span class="n">file_records</span><span class="p">:</span>
             <span class="n">csv_file</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">get_row</span><span class="p">(</span><span class="n">line_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[78]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">readFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_business.json&#39;</span><span class="p">)</span>
<span class="n">writeFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_business.csv&#39;</span><span class="p">,</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">)</span>

<span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">readFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_checkin.json&#39;</span><span class="p">)</span>
<span class="n">writeFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_checkin.csv&#39;</span><span class="p">,</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">)</span>

<span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">readFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_review.json&#39;</span><span class="p">)</span>
<span class="n">writeFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_review.csv&#39;</span><span class="p">,</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">)</span>

<span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">readFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_tip.json&#39;</span><span class="p">)</span>
<span class="n">writeFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_tip.csv&#39;</span><span class="p">,</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">)</span>

<span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">readFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_user.json&#39;</span><span class="p">)</span>
<span class="n">writeFile</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_user.csv&#39;</span><span class="p">,</span> <span class="n">file_records</span><span class="p">,</span> <span class="n">column_names</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[79]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">reset</span> out
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Once deleted, variables cannot be recovered. Proceed (y/[n])? y
Flushing output cache (0 entries)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[80]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1">#Reading the csv files using pandas. Then merging and cleaning the datasets.</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[81]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">bussiness</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_business.csv&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">unicode</span><span class="p">)</span>
<span class="n">checkin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_checkin.csv&#39;</span><span class="p">)</span>
<span class="n">review</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_review.csv&#39;</span><span class="p">)</span>
<span class="n">tip</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_tip.csv&#39;</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yelp_academic_dataset_user.csv&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[82]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1">#Merging dataframes</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[83]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">reviewUser</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_review&#39;</span><span class="p">,</span> <span class="s1">&#39;_user&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[84]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">businessReviewUser</span> <span class="o">=</span> <span class="n">reviewUser</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bussiness</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;business_id&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;business_id&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span>
                                                   <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_reviewuser&#39;</span><span class="p">,</span> <span class="s1">&#39;_business&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[85]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">businessReviewUser</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[85]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>review_id</th>
      <th>text</th>
      <th>votes.cool_review</th>
      <th>business_id</th>
      <th>votes.funny_review</th>
      <th>stars_reviewuser</th>
      <th>date</th>
      <th>type_review</th>
      <th>votes.useful_review</th>
      <th>...</th>
      <th>attributes.Noise Level</th>
      <th>attributes.Smoking</th>
      <th>attributes.Attire</th>
      <th>attributes.Hair Types Specialized In.curly</th>
      <th>attributes.Good For Groups</th>
      <th>neighborhoods</th>
      <th>attributes.Open 24 Hours</th>
      <th>attributes.Ambience.romantic</th>
      <th>attributes.Music.jukebox</th>
      <th>attributes.Ambience.upscale</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>0 rows &#215; 129 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[86]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1">#rename columns in merge dataframe</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[87]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">businessReviewUser</span> <span class="o">=</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name_reviewuser&#39;</span><span class="p">:</span><span class="s1">&#39;name_user&#39;</span><span class="p">,</span>
                                                                        <span class="s1">&#39;review_count_reviewuser&#39;</span><span class="p">:</span><span class="s1">&#39;review_count_user&#39;</span><span class="p">,</span>
                                                                        <span class="s1">&#39;stars_reviewuser&#39;</span><span class="p">:</span><span class="s1">&#39;stars_review&#39;</span><span class="p">})</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[88]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">businessReviewUser</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;[Kk]ids&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[88]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>attributes.Hair Types Specialized In.kids</th>
      <th>attributes.Good for Kids</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[89]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1">#Removing spaces from column names and replacing them with underscores.</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[90]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">columns</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">))</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
<span class="n">businessReviewUser</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[91]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">firstFewRows</span> <span class="o">=</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,[</span><span class="s1">&#39;categories&#39;</span><span class="p">,</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">firstFewRowsList</span> <span class="o">=</span> <span class="n">firstFewRows</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">restaurantsDF</span> <span class="o">=</span> <span class="n">firstFewRows</span><span class="p">[</span><span class="n">firstFewRows</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Restaurants&#39;</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[92]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">businessReviewUser</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;user_name&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;stars_business&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;attributes.takes_reservations&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;stars_review&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;hours.monday.open&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;name_business&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;categories&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;city&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;votes.cool_user&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;votes.funny_user&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;votes.useful_user&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;text&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;votes.cool_review&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;votes.funny_review&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;votes.useful_review&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;review_count_business&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[92]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>user_name</th>
      <th>stars_business</th>
      <th>attributes.takes_reservations</th>
      <th>stars_review</th>
      <th>hours.monday.open</th>
      <th>name_business</th>
      <th>categories</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>city</th>
      <th>votes.cool_user</th>
      <th>votes.funny_user</th>
      <th>votes.useful_user</th>
      <th>text</th>
      <th>votes.cool_review</th>
      <th>votes.funny_review</th>
      <th>votes.useful_review</th>
      <th>review_count_business</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012-08-01</td>
      <td>NaN</td>
      <td>4.5</td>
      <td>False</td>
      <td>4.0</td>
      <td>11:00</td>
      <td>Mr Hoagie</td>
      <td>[&#39;Fast Food&#39;, &#39;Restaurants&#39;]</td>
      <td>40.3543266</td>
      <td>-79.9007057</td>
      <td>Dravosburg</td>
      <td>12.0</td>
      <td>25.0</td>
      <td>166.0</td>
      <td>Mr Hoagie is an institution. Walking in, it do...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2014-02-13</td>
      <td>NaN</td>
      <td>4.5</td>
      <td>False</td>
      <td>5.0</td>
      <td>11:00</td>
      <td>Mr Hoagie</td>
      <td>[&#39;Fast Food&#39;, &#39;Restaurants&#39;]</td>
      <td>40.3543266</td>
      <td>-79.9007057</td>
      <td>Dravosburg</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>Excellent food. Superb customer service. I mis...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-10-31</td>
      <td>NaN</td>
      <td>4.5</td>
      <td>False</td>
      <td>5.0</td>
      <td>11:00</td>
      <td>Mr Hoagie</td>
      <td>[&#39;Fast Food&#39;, &#39;Restaurants&#39;]</td>
      <td>40.3543266</td>
      <td>-79.9007057</td>
      <td>Dravosburg</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>Yes this place is a little out dated and not o...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2012-08-01</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>Shop &#39;n Save</td>
      <td>[&#39;Food&#39;, &#39;Grocery&#39;]</td>
      <td>40.3736775</td>
      <td>-79.8737336</td>
      <td>West Mifflin</td>
      <td>12.0</td>
      <td>25.0</td>
      <td>166.0</td>
      <td>It is now a shop and save.</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2014-07-26</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>Shop &#39;n Save</td>
      <td>[&#39;Food&#39;, &#39;Grocery&#39;]</td>
      <td>40.3736775</td>
      <td>-79.8737336</td>
      <td>West Mifflin</td>
      <td>27.0</td>
      <td>9.0</td>
      <td>52.0</td>
      <td>living alone I love the 5 for $20 deals they h...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[93]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;attributes&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%55s</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">column</span>, &#39;\t&#39;,businessReviewUser[column].unique()
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>                              attributes.ambience.divey 	[&#39;False&#39; nan &#39;True&#39;]
                  attributes.dietary_restrictions.vegan 	[nan &#39;False&#39; &#39;True&#39;]
                                  attributes.happy_hour 	[nan &#39;True&#39; &#39;False&#39;]
                            attributes.order_at_counter 	[nan &#39;False&#39; &#39;True&#39;]
   attributes.hair_types_specialized_in.africanamerican 	[nan &#39;True&#39; &#39;False&#39;]
              attributes.hair_types_specialized_in.kids 	[nan &#39;False&#39; &#39;True&#39;]
                                        attributes.byob 	[nan &#39;True&#39; &#39;False&#39;]
                          attributes.good_for.latenight 	[&#39;False&#39; nan &#39;True&#39;]
                             attributes.outdoor_seating 	[&#39;False&#39; nan &#39;True&#39;]
                                     attributes.alcohol 	[&#39;none&#39; nan &#39;beer_and_wine&#39; &#39;full_bar&#39;]
                             attributes.ambience.classy 	[&#39;False&#39; nan &#39;True&#39;]
                         attributes.by_appointment_only 	[nan &#39;False&#39; &#39;True&#39;]
                                 attributes.parking.lot 	[&#39;False&#39; &#39;True&#39; nan]
                           attributes.ambience.touristy 	[&#39;False&#39; nan &#39;True&#39;]
                                     attributes.corkage 	[nan &#39;False&#39; &#39;True&#39;]
                             attributes.good_for.brunch 	[&#39;False&#39; nan &#39;True&#39;]
                              attributes.waiter_service 	[&#39;False&#39; nan &#39;True&#39;]
                              attributes.parking.street 	[&#39;False&#39; &#39;True&#39; nan]
                            attributes.ambience.hipster 	[&#39;False&#39; nan &#39;True&#39;]
                                attributes.byob/corkage 	[nan &#39;yes_free&#39; &#39;yes_corkage&#39; &#39;no&#39;]
     attributes.hair_types_specialized_in.straightperms 	[nan &#39;True&#39; &#39;False&#39;]
                                  attributes.music.live 	[nan &#39;False&#39; &#39;True&#39;]
             attributes.dietary_restrictions.dairy-free 	[nan &#39;True&#39; &#39;False&#39;]
                      attributes.music.background_music 	[nan &#39;True&#39; &#39;False&#39;]
                                 attributes.price_range 	[&#39;1&#39; &#39;2&#39; &#39;3&#39; nan &#39;4&#39;]
                          attributes.good_for.breakfast 	[&#39;False&#39; nan &#39;True&#39;]
                              attributes.parking.garage 	[&#39;False&#39; nan &#39;True&#39;]
                               attributes.music.karaoke 	[nan &#39;False&#39; &#39;True&#39;]
                            attributes.good_for_dancing 	[nan &#39;False&#39; &#39;True&#39;]
             attributes.hair_types_specialized_in.asian 	[nan &#39;True&#39; &#39;False&#39;]
                        attributes.accepts_credit_cards 	[&#39;True&#39; &#39;False&#39; nan]
                              attributes.good_for.lunch 	[&#39;False&#39; nan &#39;True&#39;]
                               attributes.parking.valet 	[&#39;False&#39; nan &#39;True&#39;]
                                    attributes.take-out 	[&#39;True&#39; nan &#39;False&#39;]
          attributes.hair_types_specialized_in.coloring 	[nan &#39;True&#39; &#39;False&#39;]
                            attributes.good_for.dessert 	[&#39;False&#39; nan &#39;True&#39;]
                                 attributes.music.video 	[nan &#39;False&#39; &#39;True&#39;]
                  attributes.dietary_restrictions.halal 	[nan &#39;False&#39; &#39;True&#39;]
                          attributes.takes_reservations 	[&#39;False&#39; nan &#39;True&#39;]
                                attributes.ages_allowed 	[nan &#39;21plus&#39; &#39;18plus&#39; &#39;allages&#39; &#39;19plus&#39;]
                             attributes.ambience.trendy 	[&#39;False&#39; nan &#39;True&#39;]
                                    attributes.delivery 	[&#39;False&#39; nan &#39;True&#39;]
                                       attributes.wi-fi 	[nan &#39;no&#39; &#39;free&#39; &#39;paid&#39;]
                       attributes.wheelchair_accessible 	[nan &#39;True&#39; &#39;False&#39;]
            attributes.dietary_restrictions.gluten-free 	[nan &#39;False&#39; &#39;True&#39;]
                 attributes.dietary_restrictions.kosher 	[nan &#39;False&#39; &#39;True&#39;]
                                      attributes.caters 	[&#39;False&#39; nan &#39;True&#39;]
                           attributes.ambience.intimate 	[&#39;False&#39; nan &#39;True&#39;]
                             attributes.good_for.dinner 	[&#39;False&#39; nan &#39;True&#39;]
                                  attributes.coat_check 	[nan &#39;False&#39; &#39;True&#39;]
        attributes.hair_types_specialized_in.extensions 	[nan &#39;True&#39; &#39;False&#39;]
                               attributes.good_for_kids 	[&#39;True&#39; nan &#39;False&#39;]
                           attributes.parking.validated 	[&#39;False&#39; nan &#39;True&#39;]
                           attributes.accepts_insurance 	[nan &#39;False&#39; &#39;True&#39;]
                                    attributes.music.dj 	[nan &#39;False&#39; &#39;True&#39;]
               attributes.dietary_restrictions.soy-free 	[nan &#39;False&#39; &#39;True&#39;]
                                      attributes.has_tv 	[&#39;False&#39; nan &#39;True&#39;]
                             attributes.ambience.casual 	[&#39;False&#39; nan &#39;True&#39;]
             attributes.hair_types_specialized_in.perms 	[nan &#39;True&#39; &#39;False&#39;]
                                attributes.dogs_allowed 	[nan &#39;False&#39; &#39;True&#39;]
                                  attributes.drive-thru 	[&#39;False&#39; nan &#39;True&#39;]
             attributes.dietary_restrictions.vegetarian 	[nan &#39;True&#39; &#39;False&#39;]
                                 attributes.noise_level 	[&#39;average&#39; nan &#39;quiet&#39; &#39;loud&#39; &#39;very_loud&#39;]
                                     attributes.smoking 	[nan &#39;no&#39; &#39;outdoor&#39; &#39;yes&#39;]
                                      attributes.attire 	[&#39;casual&#39; nan &#39;dressy&#39; &#39;formal&#39;]
             attributes.hair_types_specialized_in.curly 	[nan &#39;True&#39; &#39;False&#39;]
                             attributes.good_for_groups 	[&#39;True&#39; nan &#39;False&#39;]
                               attributes.open_24_hours 	[nan &#39;False&#39; &#39;True&#39;]
                           attributes.ambience.romantic 	[&#39;False&#39; nan &#39;True&#39;]
                               attributes.music.jukebox 	[nan &#39;False&#39; &#39;True&#39;]
                            attributes.ambience.upscale 	[&#39;False&#39; nan &#39;True&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[94]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">plotStarsHistogram</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
    <span class="n">fullDF</span> <span class="o">=</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,[</span><span class="n">colName</span><span class="p">,</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
    <span class="n">trueDF</span> <span class="o">=</span> <span class="n">fullDF</span><span class="p">[</span><span class="n">fullDF</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;True&#39;</span><span class="p">])]</span>
    <span class="n">falseDF</span> <span class="o">=</span> <span class="n">fullDF</span><span class="p">[</span><span class="n">fullDF</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;False&#39;</span><span class="p">])]</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Rating in Stars&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency&#39;</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="n">trueDF</span><span class="p">[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">],</span><span class="n">falseDF</span><span class="p">[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">],</span> 
                                <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;True&#39;</span><span class="p">,</span><span class="s1">&#39;False&#39;</span><span class="p">],</span><span class="n">rwidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[95]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">calculateCorrelation</span><span class="p">(</span><span class="n">colName</span><span class="p">):</span>
    <span class="n">fullDF</span> <span class="o">=</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,[</span><span class="n">colName</span><span class="p">,</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
    <span class="n">trueDF</span> <span class="o">=</span> <span class="n">fullDF</span><span class="p">[</span><span class="n">fullDF</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;True&#39;</span><span class="p">])]</span>
    <span class="n">falseDF</span> <span class="o">=</span> <span class="n">fullDF</span><span class="p">[</span><span class="n">fullDF</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;False&#39;</span><span class="p">])]</span>
    <span class="n">positiveRating</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">trueHigh</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueDF</span><span class="p">[</span><span class="n">trueDF</span><span class="p">[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">positiveRating</span><span class="p">])</span>
    <span class="n">trueLow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trueDF</span><span class="p">[</span><span class="n">trueDF</span><span class="p">[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">positiveRating</span><span class="p">])</span>
    <span class="n">falseHigh</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">falseDF</span><span class="p">[</span><span class="n">falseDF</span><span class="p">[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">positiveRating</span><span class="p">])</span>
    <span class="n">falseLow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">falseDF</span><span class="p">[</span><span class="n">falseDF</span><span class="p">[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">positiveRating</span><span class="p">])</span>
    <span class="c1">#print (trueHigh+falseLow)</span>
    <span class="n">totalSamples</span> <span class="o">=</span> <span class="n">trueHigh</span><span class="o">+</span><span class="n">trueLow</span><span class="o">+</span><span class="n">falseHigh</span><span class="o">+</span><span class="n">falseLow</span>
    <span class="k">print</span> <span class="s2">&quot;Statistics for Column&quot;</span><span class="p">,</span><span class="n">colName</span>
    <span class="k">print</span> <span class="s2">&quot;Total number of Samples are&quot;</span><span class="p">,</span> <span class="n">totalSamples</span>
    <span class="k">print</span> <span class="s2">&quot;Total number of True-High Samples are&quot;</span><span class="p">,</span> <span class="n">trueHigh</span>
    <span class="k">print</span> <span class="s2">&quot;Total number of True-Low Samples are&quot;</span><span class="p">,</span> <span class="n">trueLow</span>
    <span class="k">print</span> <span class="s2">&quot;Total number of False-High Samples are&quot;</span><span class="p">,</span> <span class="n">falseHigh</span>
    <span class="k">print</span> <span class="s2">&quot;Total number of False-Low Samples are&quot;</span><span class="p">,</span> <span class="n">falseLow</span>
    <span class="k">print</span> <span class="s2">&quot;Percentage correlation between:&quot;</span><span class="p">,</span><span class="n">colName</span><span class="p">,</span><span class="s2">&quot;and review stars is&quot;</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">trueHigh</span><span class="o">+</span><span class="n">falseLow</span><span class="p">)</span><span class="o">/</span><span class="n">totalSamples</span><span class="p">,</span><span class="s2">&quot;%&quot;</span>
    <span class="k">print</span> <span class="s2">&quot;-------------------------------------------------------&quot;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[96]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">plotStarsHistogram</span><span class="p">(</span><span class="s1">&#39;attributes.takes_reservations&#39;</span><span class="p">)</span>
<span class="n">plotStarsHistogram</span><span class="p">(</span><span class="s1">&#39;attributes.drive-thru&#39;</span><span class="p">)</span>
<span class="n">plotStarsHistogram</span><span class="p">(</span><span class="s1">&#39;attributes.delivery&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[97]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">businessReviewUser</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;attributes&#39;</span> <span class="ow">in</span> <span class="n">column</span> <span class="ow">and</span> <span class="s1">&#39;True&#39;</span> <span class="ow">in</span> <span class="n">businessReviewUser</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">calculateCorrelation</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Statistics for Column attributes.ambience.divey
Total number of Samples are 81569
Total number of True-High Samples are 4690
Total number of True-Low Samples are 1903
Total number of False-High Samples are 50503
Total number of False-Low Samples are 24473
Percentage correlation between: attributes.ambience.divey and review stars is 35 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.vegan
Total number of Samples are 164
Total number of True-High Samples are 0
Total number of True-Low Samples are 0
Total number of False-High Samples are 82
Total number of False-Low Samples are 82
Percentage correlation between: attributes.dietary_restrictions.vegan and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.happy_hour
Total number of Samples are 22709
Total number of True-High Samples are 12167
Total number of True-Low Samples are 6102
Total number of False-High Samples are 2752
Total number of False-Low Samples are 1688
Percentage correlation between: attributes.happy_hour and review stars is 61 %
-------------------------------------------------------
Statistics for Column attributes.order_at_counter
Total number of Samples are 10639
Total number of True-High Samples are 3429
Total number of True-Low Samples are 1796
Total number of False-High Samples are 3536
Total number of False-Low Samples are 1878
Percentage correlation between: attributes.order_at_counter and review stars is 49 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.africanamerican
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.africanamerican and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.kids
Total number of Samples are 80
Total number of True-High Samples are 0
Total number of True-Low Samples are 0
Total number of False-High Samples are 61
Total number of False-Low Samples are 19
Percentage correlation between: attributes.hair_types_specialized_in.kids and review stars is 23 %
-------------------------------------------------------
Statistics for Column attributes.byob
Total number of Samples are 24098
Total number of True-High Samples are 319
Total number of True-Low Samples are 137
Total number of False-High Samples are 16517
Total number of False-Low Samples are 7125
Percentage correlation between: attributes.byob and review stars is 30 %
-------------------------------------------------------
Statistics for Column attributes.good_for.latenight
Total number of Samples are 80782
Total number of True-High Samples are 8899
Total number of True-Low Samples are 4280
Total number of False-High Samples are 46046
Total number of False-Low Samples are 21557
Percentage correlation between: attributes.good_for.latenight and review stars is 37 %
-------------------------------------------------------
Statistics for Column attributes.outdoor_seating
Total number of Samples are 87365
Total number of True-High Samples are 30295
Total number of True-Low Samples are 13848
Total number of False-High Samples are 29251
Total number of False-Low Samples are 13971
Percentage correlation between: attributes.outdoor_seating and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.ambience.classy
Total number of Samples are 81569
Total number of True-High Samples are 5827
Total number of True-Low Samples are 2289
Total number of False-High Samples are 49366
Total number of False-Low Samples are 24087
Percentage correlation between: attributes.ambience.classy and review stars is 36 %
-------------------------------------------------------
Statistics for Column attributes.by_appointment_only
Total number of Samples are 967
Total number of True-High Samples are 198
Total number of True-Low Samples are 54
Total number of False-High Samples are 513
Total number of False-Low Samples are 202
Percentage correlation between: attributes.by_appointment_only and review stars is 41 %
-------------------------------------------------------
Statistics for Column attributes.parking.lot
Total number of Samples are 88955
Total number of True-High Samples are 12917
Total number of True-Low Samples are 4643
Total number of False-High Samples are 48302
Total number of False-Low Samples are 23093
Percentage correlation between: attributes.parking.lot and review stars is 40 %
-------------------------------------------------------
Statistics for Column attributes.ambience.touristy
Total number of Samples are 81569
Total number of True-High Samples are 461
Total number of True-Low Samples are 1148
Total number of False-High Samples are 54732
Total number of False-Low Samples are 25228
Percentage correlation between: attributes.ambience.touristy and review stars is 31 %
-------------------------------------------------------
Statistics for Column attributes.corkage
Total number of Samples are 19577
Total number of True-High Samples are 3841
Total number of True-Low Samples are 1073
Total number of False-High Samples are 10081
Total number of False-Low Samples are 4582
Percentage correlation between: attributes.corkage and review stars is 43 %
-------------------------------------------------------
Statistics for Column attributes.good_for.brunch
Total number of Samples are 80768
Total number of True-High Samples are 9486
Total number of True-Low Samples are 5099
Total number of False-High Samples are 45451
Total number of False-Low Samples are 20732
Percentage correlation between: attributes.good_for.brunch and review stars is 37 %
-------------------------------------------------------
Statistics for Column attributes.waiter_service
Total number of Samples are 81610
Total number of True-High Samples are 47565
Total number of True-Low Samples are 22494
Total number of False-High Samples are 8089
Total number of False-Low Samples are 3462
Percentage correlation between: attributes.waiter_service and review stars is 62 %
-------------------------------------------------------
Statistics for Column attributes.parking.street
Total number of Samples are 88955
Total number of True-High Samples are 25768
Total number of True-Low Samples are 11203
Total number of False-High Samples are 35451
Total number of False-Low Samples are 16533
Percentage correlation between: attributes.parking.street and review stars is 47 %
-------------------------------------------------------
Statistics for Column attributes.ambience.hipster
Total number of Samples are 81569
Total number of True-High Samples are 2565
Total number of True-Low Samples are 1356
Total number of False-High Samples are 52628
Total number of False-Low Samples are 25020
Percentage correlation between: attributes.ambience.hipster and review stars is 33 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.straightperms
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.straightperms and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.music.live
Total number of Samples are 14675
Total number of True-High Samples are 1292
Total number of True-Low Samples are 674
Total number of False-High Samples are 8044
Total number of False-Low Samples are 4665
Percentage correlation between: attributes.music.live and review stars is 40 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.dairy-free
Total number of Samples are 164
Total number of True-High Samples are 42
Total number of True-Low Samples are 50
Total number of False-High Samples are 40
Total number of False-Low Samples are 32
Percentage correlation between: attributes.dietary_restrictions.dairy-free and review stars is 45 %
-------------------------------------------------------
Statistics for Column attributes.music.background_music
Total number of Samples are 10164
Total number of True-High Samples are 4925
Total number of True-Low Samples are 2523
Total number of False-High Samples are 1646
Total number of False-Low Samples are 1070
Percentage correlation between: attributes.music.background_music and review stars is 58 %
-------------------------------------------------------
Statistics for Column attributes.good_for.breakfast
Total number of Samples are 80782
Total number of True-High Samples are 7576
Total number of True-Low Samples are 3574
Total number of False-High Samples are 47369
Total number of False-Low Samples are 22263
Percentage correlation between: attributes.good_for.breakfast and review stars is 36 %
-------------------------------------------------------
Statistics for Column attributes.parking.garage
Total number of Samples are 88955
Total number of True-High Samples are 26115
Total number of True-Low Samples are 13340
Total number of False-High Samples are 35104
Total number of False-Low Samples are 14396
Percentage correlation between: attributes.parking.garage and review stars is 45 %
-------------------------------------------------------
Statistics for Column attributes.music.karaoke
Total number of Samples are 10238
Total number of True-High Samples are 56
Total number of True-Low Samples are 34
Total number of False-High Samples are 6557
Total number of False-Low Samples are 3591
Percentage correlation between: attributes.music.karaoke and review stars is 35 %
-------------------------------------------------------
Statistics for Column attributes.good_for_dancing
Total number of Samples are 23029
Total number of True-High Samples are 3635
Total number of True-Low Samples are 2306
Total number of False-High Samples are 11549
Total number of False-Low Samples are 5539
Percentage correlation between: attributes.good_for_dancing and review stars is 39 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.asian
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.asian and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.accepts_credit_cards
Total number of Samples are 96950
Total number of True-High Samples are 61759
Total number of True-Low Samples are 30637
Total number of False-High Samples are 3391
Total number of False-Low Samples are 1163
Percentage correlation between: attributes.accepts_credit_cards and review stars is 64 %
-------------------------------------------------------
Statistics for Column attributes.good_for.lunch
Total number of Samples are 80782
Total number of True-High Samples are 15775
Total number of True-Low Samples are 8667
Total number of False-High Samples are 39170
Total number of False-Low Samples are 17170
Percentage correlation between: attributes.good_for.lunch and review stars is 40 %
-------------------------------------------------------
Statistics for Column attributes.parking.valet
Total number of Samples are 88955
Total number of True-High Samples are 15383
Total number of True-Low Samples are 7331
Total number of False-High Samples are 45836
Total number of False-Low Samples are 20405
Percentage correlation between: attributes.parking.valet and review stars is 40 %
-------------------------------------------------------
Statistics for Column attributes.take-out
Total number of Samples are 81705
Total number of True-High Samples are 42330
Total number of True-Low Samples are 19308
Total number of False-High Samples are 13390
Total number of False-Low Samples are 6677
Percentage correlation between: attributes.take-out and review stars is 59 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.coloring
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.coloring and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.good_for.dessert
Total number of Samples are 80768
Total number of True-High Samples are 2149
Total number of True-Low Samples are 611
Total number of False-High Samples are 52788
Total number of False-Low Samples are 25220
Percentage correlation between: attributes.good_for.dessert and review stars is 33 %
-------------------------------------------------------
Statistics for Column attributes.music.video
Total number of Samples are 14583
Total number of True-High Samples are 43
Total number of True-Low Samples are 18
Total number of False-High Samples are 9252
Total number of False-Low Samples are 5270
Percentage correlation between: attributes.music.video and review stars is 36 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.halal
Total number of Samples are 164
Total number of True-High Samples are 0
Total number of True-Low Samples are 0
Total number of False-High Samples are 82
Total number of False-Low Samples are 82
Percentage correlation between: attributes.dietary_restrictions.halal and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.takes_reservations
Total number of Samples are 79829
Total number of True-High Samples are 32420
Total number of True-Low Samples are 15179
Total number of False-High Samples are 21967
Total number of False-Low Samples are 10263
Percentage correlation between: attributes.takes_reservations and review stars is 53 %
-------------------------------------------------------
Statistics for Column attributes.ambience.trendy
Total number of Samples are 81569
Total number of True-High Samples are 10718
Total number of True-Low Samples are 5022
Total number of False-High Samples are 44475
Total number of False-Low Samples are 21354
Percentage correlation between: attributes.ambience.trendy and review stars is 39 %
-------------------------------------------------------
Statistics for Column attributes.delivery
Total number of Samples are 81688
Total number of True-High Samples are 6503
Total number of True-Low Samples are 3018
Total number of False-High Samples are 49222
Total number of False-Low Samples are 22945
Percentage correlation between: attributes.delivery and review stars is 36 %
-------------------------------------------------------
Statistics for Column attributes.wheelchair_accessible
Total number of Samples are 70600
Total number of True-High Samples are 44750
Total number of True-Low Samples are 19968
Total number of False-High Samples are 3980
Total number of False-Low Samples are 1902
Percentage correlation between: attributes.wheelchair_accessible and review stars is 66 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.gluten-free
Total number of Samples are 164
Total number of True-High Samples are 0
Total number of True-Low Samples are 0
Total number of False-High Samples are 82
Total number of False-Low Samples are 82
Percentage correlation between: attributes.dietary_restrictions.gluten-free and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.kosher
Total number of Samples are 164
Total number of True-High Samples are 0
Total number of True-Low Samples are 0
Total number of False-High Samples are 82
Total number of False-Low Samples are 82
Percentage correlation between: attributes.dietary_restrictions.kosher and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.caters
Total number of Samples are 75133
Total number of True-High Samples are 15595
Total number of True-Low Samples are 7067
Total number of False-High Samples are 35375
Total number of False-Low Samples are 17096
Percentage correlation between: attributes.caters and review stars is 43 %
-------------------------------------------------------
Statistics for Column attributes.ambience.intimate
Total number of Samples are 81569
Total number of True-High Samples are 1129
Total number of True-Low Samples are 405
Total number of False-High Samples are 54064
Total number of False-Low Samples are 25971
Percentage correlation between: attributes.ambience.intimate and review stars is 33 %
-------------------------------------------------------
Statistics for Column attributes.good_for.dinner
Total number of Samples are 80782
Total number of True-High Samples are 33301
Total number of True-Low Samples are 14338
Total number of False-High Samples are 21644
Total number of False-Low Samples are 11499
Percentage correlation between: attributes.good_for.dinner and review stars is 55 %
-------------------------------------------------------
Statistics for Column attributes.coat_check
Total number of Samples are 22846
Total number of True-High Samples are 3874
Total number of True-Low Samples are 2287
Total number of False-High Samples are 11135
Total number of False-Low Samples are 5550
Percentage correlation between: attributes.coat_check and review stars is 41 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.extensions
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.extensions and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.good_for_kids
Total number of Samples are 92749
Total number of True-High Samples are 33725
Total number of True-Low Samples are 16797
Total number of False-High Samples are 28901
Total number of False-Low Samples are 13326
Percentage correlation between: attributes.good_for_kids and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.parking.validated
Total number of Samples are 88955
Total number of True-High Samples are 216
Total number of True-Low Samples are 151
Total number of False-High Samples are 61003
Total number of False-Low Samples are 27585
Percentage correlation between: attributes.parking.validated and review stars is 31 %
-------------------------------------------------------
Statistics for Column attributes.accepts_insurance
Total number of Samples are 29
Total number of True-High Samples are 0
Total number of True-Low Samples are 0
Total number of False-High Samples are 18
Total number of False-Low Samples are 11
Percentage correlation between: attributes.accepts_insurance and review stars is 37 %
-------------------------------------------------------
Statistics for Column attributes.music.dj
Total number of Samples are 21114
Total number of True-High Samples are 2539
Total number of True-Low Samples are 1522
Total number of False-High Samples are 11375
Total number of False-Low Samples are 5678
Percentage correlation between: attributes.music.dj and review stars is 38 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.soy-free
Total number of Samples are 164
Total number of True-High Samples are 40
Total number of True-Low Samples are 32
Total number of False-High Samples are 42
Total number of False-Low Samples are 50
Percentage correlation between: attributes.dietary_restrictions.soy-free and review stars is 54 %
-------------------------------------------------------
Statistics for Column attributes.has_tv
Total number of Samples are 81671
Total number of True-High Samples are 29178
Total number of True-Low Samples are 15336
Total number of False-High Samples are 26022
Total number of False-Low Samples are 11135
Percentage correlation between: attributes.has_tv and review stars is 49 %
-------------------------------------------------------
Statistics for Column attributes.ambience.casual
Total number of Samples are 81569
Total number of True-High Samples are 28656
Total number of True-Low Samples are 14858
Total number of False-High Samples are 26537
Total number of False-Low Samples are 11518
Percentage correlation between: attributes.ambience.casual and review stars is 49 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.perms
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.perms and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.dogs_allowed
Total number of Samples are 9430
Total number of True-High Samples are 490
Total number of True-Low Samples are 277
Total number of False-High Samples are 5712
Total number of False-Low Samples are 2951
Percentage correlation between: attributes.dogs_allowed and review stars is 36 %
-------------------------------------------------------
Statistics for Column attributes.drive-thru
Total number of Samples are 7473
Total number of True-High Samples are 24
Total number of True-Low Samples are 32
Total number of False-High Samples are 4812
Total number of False-Low Samples are 2605
Percentage correlation between: attributes.drive-thru and review stars is 35 %
-------------------------------------------------------
Statistics for Column attributes.dietary_restrictions.vegetarian
Total number of Samples are 164
Total number of True-High Samples are 82
Total number of True-Low Samples are 82
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.dietary_restrictions.vegetarian and review stars is 50 %
-------------------------------------------------------
Statistics for Column attributes.hair_types_specialized_in.curly
Total number of Samples are 80
Total number of True-High Samples are 61
Total number of True-Low Samples are 19
Total number of False-High Samples are 0
Total number of False-Low Samples are 0
Percentage correlation between: attributes.hair_types_specialized_in.curly and review stars is 76 %
-------------------------------------------------------
Statistics for Column attributes.good_for_groups
Total number of Samples are 86399
Total number of True-High Samples are 53007
Total number of True-Low Samples are 25941
Total number of False-High Samples are 5864
Total number of False-Low Samples are 1587
Percentage correlation between: attributes.good_for_groups and review stars is 63 %
-------------------------------------------------------
Statistics for Column attributes.open_24_hours
Total number of Samples are 13330
Total number of True-High Samples are 380
Total number of True-Low Samples are 52
Total number of False-High Samples are 8737
Total number of False-Low Samples are 4161
Percentage correlation between: attributes.open_24_hours and review stars is 34 %
-------------------------------------------------------
Statistics for Column attributes.ambience.romantic
Total number of Samples are 81569
Total number of True-High Samples are 305
Total number of True-Low Samples are 209
Total number of False-High Samples are 54888
Total number of False-Low Samples are 26167
Percentage correlation between: attributes.ambience.romantic and review stars is 32 %
-------------------------------------------------------
Statistics for Column attributes.music.jukebox
Total number of Samples are 15235
Total number of True-High Samples are 2055
Total number of True-Low Samples are 867
Total number of False-High Samples are 7696
Total number of False-Low Samples are 4617
Percentage correlation between: attributes.music.jukebox and review stars is 43 %
-------------------------------------------------------
Statistics for Column attributes.ambience.upscale
Total number of Samples are 81486
Total number of True-High Samples are 3839
Total number of True-Low Samples are 1500
Total number of False-High Samples are 51306
Total number of False-Low Samples are 24841
Percentage correlation between: attributes.ambience.upscale and review stars is 35 %
-------------------------------------------------------
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[98]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">restaurant_cat</span><span class="o">=</span> <span class="n">restaurantsDF</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;categories&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">restaurant_tsr</span> <span class="o">=</span> <span class="n">restaurantsDF</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;stars_review&#39;</span><span class="p">]]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[99]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1">#restaurant_cat</span>
<span class="c1">#restaurant_tsr</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[102]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[103]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Length of the review&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of reviews&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[103]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.text.Text at 0x259967828&gt;</pre>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[104]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">restaurantsDF</span><span class="o">.</span><span class="n">stars_review</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">xticks</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rating stars&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of reviews&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[105]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Initial Model Assign average rating as the predicted rating.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[106]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">restaurantsDF</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">stars_review</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">restaurantsDF</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">stars_review</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

<span class="k">print</span> <span class="s2">&quot;Initial Model Rating:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">stars_review</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">restaurantsDF</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Initial Model Rating: 4.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[107]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">m1</span> <span class="o">=</span> <span class="n">restaurantsDF</span><span class="p">[[</span><span class="s1">&#39;stars_review&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted_rating&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[108]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">stars_review</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">predicted_rating</span><span class="p">)</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">stars_review</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">predicted_rating</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">stars_review</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">predicted_rating</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">stars_review</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">predicted_rating</span><span class="p">)</span>

<span class="n">InitialResult</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="n">precision</span><span class="p">,</span>
        <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span>
        <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span>
        <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span><span class="n">accuracy</span><span class="p">}</span>

<span class="n">InitialResult</span><span class="p">[</span><span class="s1">&#39;Initial Model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">InitialResult</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[108]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>accuracy</th>
      <th>f1_score</th>
      <th>precision</th>
      <th>recall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Initial Model</th>
      <td>0.331256</td>
      <td>0.164853</td>
      <td>0.10973</td>
      <td>0.331256</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[109]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">central_tendency_plot</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">plot_error_dist</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">med</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">std</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">gauss</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">xticks</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">bin_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">m_y</span> <span class="o">=</span> <span class="n">bin_max</span><span class="o">/</span><span class="mi">5</span>
    
    <span class="n">central_tendency_plot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="n">s</span><span class="p">],</span> <span class="n">m_y</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;std dev&quot;</span><span class="p">)</span>

    <span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">84</span><span class="p">])</span>
    <span class="n">central_tendency_plot</span><span class="p">(</span><span class="n">med</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span>  <span class="n">m_y</span> <span class="o">-</span> <span class="n">bin_max</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;68% CI&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Frequency&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; Error Distribution&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[112]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">error</span> <span class="o">=</span> <span class="n">restaurantsDF</span><span class="o">.</span><span class="n">stars_review</span> <span class="o">-</span> <span class="n">restaurantsDF</span><span class="o">.</span><span class="n">predicted_rating</span>
<span class="n">plot_error_dist</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="s2">&quot;Initial Model&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preparing data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Obtain the list of all stop words</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[113]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">stop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[114]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">numTopics</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[115]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">m2</span> <span class="o">=</span> <span class="n">restaurantsDF</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[116]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">minReviewLen</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">maxReviewLen</span> <span class="o">=</span> <span class="mi">500</span>

<span class="k">print</span> <span class="s2">&quot;Number of rows selected:&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="p">[</span><span class="n">m2</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">minReviewLen</span><span class="p">][</span><span class="n">m2</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">maxReviewLen</span><span class="p">])</span>
<span class="n">restaurantsDF</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="n">m2</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">minReviewLen</span><span class="p">][</span><span class="n">m2</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">maxReviewLen</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of rows selected: 31192
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[117]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">perform_lda</span><span class="p">(</span><span class="n">allReviewsTrain</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">):</span>
    <span class="n">corpus</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">allReviewsTrain</span><span class="p">:</span>
        <span class="c1"># Remove punctuations</span>
        <span class="n">review</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;[^a-zA-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">review</span><span class="p">)</span>
        <span class="c1"># To lowercase</span>
        <span class="n">review</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># Remove stop words</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">review</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">corpus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># Build dictionary</span>
    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
    <span class="n">dictionary</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;restaurant_reviews.dict&#39;</span><span class="p">)</span>
        
    <span class="c1"># Build vectorized corpus</span>
    <span class="n">corpus_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">]</span>
    <span class="c1">#corpora.MmCorpus.serialize(&#39;LDA/restaurant_reviews.mm&#39;, corpus_2)</span>
    
    <span class="n">lda</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus_2</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="n">numTopics</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="n">dictionary</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lda</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[118]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">process_reviews</span><span class="p">(</span><span class="n">dirty_data_set</span><span class="p">):</span>
    <span class="n">clean_data_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">dirty_data_set</span><span class="p">:</span>
        <span class="c1"># Remove punctuations</span>
        <span class="n">review</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;[^a-zA-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">review</span><span class="p">)</span>
        <span class="c1"># To lowercase</span>
        <span class="n">review</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># Remove stop words</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">review</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clean_data_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">texts</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">clean_data_set</span>

<span class="c1"># Generates a matrix of topic probabilities for each document in matrix</span>
<span class="c1"># Returns topic_dist for the input corpus, and all_dist, a running sum of all the corpuses</span>
<span class="k">def</span> <span class="nf">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus</span><span class="p">,</span> <span class="n">all_dist</span><span class="p">,</span> <span class="n">star</span><span class="p">):</span>
    <span class="n">topic_dist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numTopics</span>
    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;restaurant_reviews.dict&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">corpus</span><span class="p">:</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">lda</span><span class="p">[</span><span class="n">vec</span><span class="p">]</span>
        <span class="n">highest_prob</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">highest_topic</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numTopics</span>    <span class="c1"># List to keep track of topic distribution for each document</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">this_topic</span><span class="p">,</span> <span class="n">this_prob</span> <span class="o">=</span> <span class="n">topic</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">this_topic</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_prob</span>
            <span class="k">if</span> <span class="n">this_prob</span> <span class="o">&gt;</span> <span class="n">highest_prob</span><span class="p">:</span>
                <span class="n">highest_prob</span> <span class="o">=</span> <span class="n">this_prob</span> 
                <span class="n">highest_topic</span> <span class="o">=</span> <span class="n">this_topic</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star</span><span class="p">)</span>
        <span class="n">all_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">topic_dist</span><span class="p">[</span><span class="n">highest_topic</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">topic_dist</span><span class="p">,</span> <span class="n">all_dist</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[119]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">SG</span> <span class="o">=</span> <span class="n">restaurantsDF</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;stars_review&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[122]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">star1</span> <span class="o">=</span> <span class="n">SG</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">star2</span> <span class="o">=</span> <span class="n">SG</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">star3</span> <span class="o">=</span> <span class="n">SG</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">star4</span> <span class="o">=</span> <span class="n">SG</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">star5</span> <span class="o">=</span> <span class="n">SG</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[123]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">star1_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">star1</span><span class="p">)</span>
<span class="n">star2_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">star2</span><span class="p">)</span>
<span class="n">star3_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">star3</span><span class="p">)</span>
<span class="n">star4_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">star4</span><span class="p">)</span>
<span class="n">star5_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">star5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Spliting into training and testing data randomly using sklearn&#39;s library</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[124]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">star1_train</span><span class="p">,</span><span class="n">star1_test</span><span class="p">,</span><span class="n">stars1_labels_train</span><span class="p">,</span><span class="n">star1_labels_test</span><span class="o">=</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">star1</span><span class="p">,</span> <span class="n">star1_labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
<span class="n">star2_train</span><span class="p">,</span><span class="n">star2_test</span><span class="p">,</span><span class="n">stars2_labels_train</span><span class="p">,</span><span class="n">star2_labels_test</span><span class="o">=</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">star2</span><span class="p">,</span> <span class="n">star2_labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
<span class="n">star3_train</span><span class="p">,</span><span class="n">star3_test</span><span class="p">,</span><span class="n">stars3_labels_train</span><span class="p">,</span><span class="n">star3_labels_test</span><span class="o">=</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">star3</span><span class="p">,</span> <span class="n">star3_labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
<span class="n">star4_train</span><span class="p">,</span><span class="n">star4_test</span><span class="p">,</span><span class="n">stars4_labels_train</span><span class="p">,</span><span class="n">star4_labels_test</span><span class="o">=</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">star4</span><span class="p">,</span> <span class="n">star4_labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
<span class="n">star5_train</span><span class="p">,</span><span class="n">star5_test</span><span class="p">,</span><span class="n">stars5_labels_train</span><span class="p">,</span><span class="n">star5_labels_test</span><span class="o">=</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">star5</span><span class="p">,</span> <span class="n">star5_labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[125]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># Process the reviews</span>
<span class="n">corpus_1stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star1_train</span><span class="p">)</span>
<span class="n">corpus_2stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star2_train</span><span class="p">)</span>
<span class="n">corpus_3stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star3_train</span><span class="p">)</span>
<span class="n">corpus_4stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star4_train</span><span class="p">)</span>
<span class="n">corpus_5stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star5_train</span><span class="p">)</span>

<span class="k">print</span> <span class="s2">&quot;Number of 5-star reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_5stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 4-star reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_4stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 3-star reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_3stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 2-star reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_2stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 1-star reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_1stars</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of 5-star reviews after processing:  10184
Number of 4-star reviews after processing:  7988
Number of 3-star reviews after processing:  3374
Number of 2-star reviews after processing:  1849
Number of 1-star reviews after processing:  1556
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[126]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">star_5_4_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corpus_5stars</span><span class="p">,</span> <span class="n">corpus_4stars</span><span class="p">)</span>
<span class="n">star_5_4_3_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star_5_4_train</span><span class="p">,</span> <span class="n">corpus_3stars</span><span class="p">)</span>
<span class="n">star_5_4_3_2_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star_5_4_3_train</span><span class="p">,</span> <span class="n">corpus_2stars</span><span class="p">)</span>
<span class="n">star_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star_5_4_3_2_train</span><span class="p">,</span> <span class="n">corpus_1stars</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[127]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">time</span> lda = perform_lda(star_train, numTopics)
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Wall time: 26.5 s
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Building the final dataframe containing topic distribution</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[128]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topic_dist_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Keep a separate list to count topics</span>
<span class="n">topic_dist_star1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_star2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_star3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_star4</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_star5</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">topic_dist_5stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_5stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">topic_dist_4stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_4stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">topic_dist_3stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_3stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">topic_dist_2stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_2stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">topic_dist_1stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_1stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">numTopics</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Star&quot;</span><span class="p">)</span>

<span class="n">topicDist_allStars_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topic_dist_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preparing test data for topic distribution.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[129]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># Process the test reviews</span>
<span class="n">corpus_5stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star5_test</span><span class="p">)</span>
<span class="n">corpus_4stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star4_test</span><span class="p">)</span>
<span class="n">corpus_3stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star3_test</span><span class="p">)</span>
<span class="n">corpus_2stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star2_test</span><span class="p">)</span>
<span class="n">corpus_1stars</span> <span class="o">=</span> <span class="n">process_reviews</span><span class="p">(</span><span class="n">star1_test</span><span class="p">)</span>

<span class="k">print</span> <span class="s2">&quot;Number of 5-star test reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_5stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 4-star test reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_4stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 3-star test reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_3stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 2-star test reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_2stars</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Number of 1-star test reviews after processing: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus_1stars</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of 5-star test reviews after processing:  2547
Number of 4-star test reviews after processing:  1997
Number of 3-star test reviews after processing:  844
Number of 2-star test reviews after processing:  463
Number of 1-star test reviews after processing:  390
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[130]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">star_5_4_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corpus_5stars</span><span class="p">,</span> <span class="n">corpus_4stars</span><span class="p">)</span>
<span class="n">star_5_4_3_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star_5_4_test</span><span class="p">,</span> <span class="n">corpus_3stars</span><span class="p">)</span>
<span class="n">star_5_4_3_2_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star_5_4_3_test</span><span class="p">,</span> <span class="n">corpus_2stars</span><span class="p">)</span>
<span class="n">star_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">star_5_4_3_2_test</span><span class="p">,</span> <span class="n">corpus_1stars</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[131]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topic_dist_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Keep a separate list to count topics</span>
<span class="n">topic_dist_5stars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_4stars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_3stars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_2stars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">topic_dist_1stars</span> <span class="o">=</span> <span class="p">[]</span>


<span class="n">topic_dist_5stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_5stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">topic_dist_4stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_4stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">topic_dist_3stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_3stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">topic_dist_2stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_2stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">topic_dist_1stars</span><span class="p">,</span> <span class="n">topic_dist_list</span> <span class="o">=</span> <span class="n">generate_topic_dist_matrix</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span> <span class="n">numTopics</span><span class="p">,</span> <span class="n">corpus_1stars</span><span class="p">,</span> <span class="n">topic_dist_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">numTopics</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Topic&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Star&quot;</span><span class="p">)</span>

<span class="n">topicDist_allStars_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">topic_dist_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[134]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topicDist_allStars_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[134]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(24951, 16)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[135]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topicDist_allStars_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[135]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(6241, 16)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[145]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">getSentiment</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">3.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[146]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">getSentiment</span><span class="p">)</span>
<span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">getSentiment</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Naive-Bayes Model</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using intuitive idea of term frequency to extract features and then using Naive-Bayes classifier to predict ratings.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[147]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">()</span>

<span class="n">TFIDF_X_train</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">star_train</span><span class="p">)</span>
<span class="n">TFIDF_X_test</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">star_test</span><span class="p">)</span>

<span class="n">TFIDF_Y_train</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span>
<span class="n">TFIDF_Y_test</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[148]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">MultinomialNB</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">()]</span>
<span class="n">clf_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nearest Neighbors&#39;</span><span class="p">,</span> <span class="s1">&#39;Multinomial Naive Bayes&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">]</span>

<span class="n">NBModel</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">clf_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clfs</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">clf_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">TFIDF_X_train</span><span class="p">,</span> <span class="n">TFIDF_Y_train</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">TFIDF_X_test</span><span class="p">)</span>
    
    <span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">TFIDF_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">TFIDF_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">TFIDF_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">TFIDF_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">TFIDF_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">TFIDF_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">SG</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="n">precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span><span class="n">accuracy</span><span class="p">,</span>
            <span class="s1">&#39;clf_report&#39;</span><span class="p">:</span><span class="n">report</span><span class="p">,</span>
            <span class="s1">&#39;clf_matrix&#39;</span><span class="p">:</span><span class="n">matrix</span><span class="p">,</span>
            <span class="s1">&#39;y_predicted&#39;</span><span class="p">:</span><span class="n">preds</span><span class="p">}</span>
    
    <span class="n">NBModel</span><span class="p">[</span><span class="n">clf_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_score&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">NBModel</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[148]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Logistic Regression</th>
      <th>Multinomial Naive Bayes</th>
      <th>Nearest Neighbors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>precision</th>
      <td>0.585304</td>
      <td>0.439617</td>
      <td>0.453506</td>
    </tr>
    <tr>
      <th>recall</th>
      <td>0.59702</td>
      <td>0.480372</td>
      <td>0.439032</td>
    </tr>
    <tr>
      <th>f1_score</th>
      <td>0.581527</td>
      <td>0.387798</td>
      <td>0.424138</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.59702</td>
      <td>0.480372</td>
      <td>0.439032</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[155]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[156]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">NBModel</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;MODEL:&#39;</span><span class="p">,</span> <span class="n">model</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;The precision for this classifier is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The recall for this classifier is    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The f1 for this classifier is        &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;f1_score&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The accuracy for this classifier is  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;Here is the classification report:&#39;</span>
    <span class="k">print</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;clf_report&#39;</span><span class="p">]</span> 
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>--------------------------
MODEL: Logistic Regression
--------------------------
The precision for this classifier is 0.585304228651
The recall for this classifier is    0.59701970838
The f1 for this classifier is        0.581526521983
The accuracy for this classifier is  0.59701970838
Here is the classification report:
             precision    recall  f1-score   support

          1       0.68      0.52      0.59       390
          2       0.48      0.23      0.31       463
          3       0.51      0.32      0.39       844
          4       0.52      0.56      0.54      1997
          5       0.67      0.80      0.73      2547

avg / total       0.59      0.60      0.58      6241

------------------------
MODEL: Nearest Neighbors
------------------------
The precision for this classifier is 0.453506252461
The recall for this classifier is    0.439032206377
The f1 for this classifier is        0.424137855129
The accuracy for this classifier is  0.439032206377
Here is the classification report:
             precision    recall  f1-score   support

          1       0.46      0.30      0.36       390
          2       0.32      0.11      0.17       463
          3       0.29      0.15      0.20       844
          4       0.37      0.64      0.47      1997
          5       0.59      0.46      0.52      2547

avg / total       0.45      0.44      0.42      6241

------------------------------
MODEL: Multinomial Naive Bayes
------------------------------
The precision for this classifier is 0.439617029268
The recall for this classifier is    0.480371735299
The f1 for this classifier is        0.387797847221
The accuracy for this classifier is  0.480371735299
Here is the classification report:
             precision    recall  f1-score   support

          1       1.00      0.01      0.02       390
          2       0.00      0.00      0.00       463
          3       0.33      0.01      0.02       844
          4       0.36      0.33      0.35      1997
          5       0.53      0.91      0.67      2547

avg / total       0.44      0.48      0.39      6241

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[157]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">NBModel</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;y_predicted&#39;</span><span class="p">]</span>
    
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">])</span>
    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TFIDF_Y_test</span>

    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">rating</span> <span class="o">-</span> <span class="n">test_df</span><span class="o">.</span><span class="n">predicted_rating</span>
    <span class="n">plot_error_dist</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>LDA Model</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To reduce processing of redundant information that i did on term frequency method, by using topic modeling to extract major topics in a review and using that as features</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[158]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">topicDist_allStars_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="n">numTopics</span><span class="p">])</span>
<span class="k">print</span> <span class="n">topics</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;Topic1&#39;, &#39;Topic2&#39;, &#39;Topic3&#39;, &#39;Topic4&#39;, &#39;Topic5&#39;, &#39;Topic6&#39;, &#39;Topic7&#39;, &#39;Topic8&#39;, &#39;Topic9&#39;, &#39;Topic10&#39;, &#39;Topic11&#39;, &#39;Topic12&#39;, &#39;Topic13&#39;, &#39;Topic14&#39;, &#39;Topic15&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[160]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="n">topics</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span>

<span class="n">x_test</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="n">topics</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span> 

<span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">MultinomialNB</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">LDA</span><span class="p">(),</span> <span class="n">QDA</span><span class="p">(),</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">clf_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nearest Neighbors&#39;</span><span class="p">,</span> <span class="s1">&#39;Multinomial Naive Bayes&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;LDA&#39;</span><span class="p">,</span> <span class="s1">&#39;QDA&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;AdaBoost&#39;</span><span class="p">]</span>

<span class="n">LDAModel</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">clf_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clfs</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">clf_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
    
    <span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">SG</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="n">precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span><span class="n">accuracy</span><span class="p">,</span>
            <span class="s1">&#39;clf_report&#39;</span><span class="p">:</span><span class="n">report</span><span class="p">,</span>
            <span class="s1">&#39;clf_matrix&#39;</span><span class="p">:</span><span class="n">matrix</span><span class="p">,</span>
            <span class="s1">&#39;y_predicted&#39;</span><span class="p">:</span><span class="n">preds</span><span class="p">}</span>
    
    <span class="n">LDAModel</span><span class="p">[</span><span class="n">clf_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_score&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">LDAModel</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[160]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AdaBoost</th>
      <th>LDA</th>
      <th>Logistic Regression</th>
      <th>Multinomial Naive Bayes</th>
      <th>Nearest Neighbors</th>
      <th>QDA</th>
      <th>Random Forest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>precision</th>
      <td>0.359739</td>
      <td>0.302586</td>
      <td>0.305603</td>
      <td>0.166552</td>
      <td>0.325767</td>
      <td>0.343105</td>
      <td>0.329964</td>
    </tr>
    <tr>
      <th>recall</th>
      <td>0.3892</td>
      <td>0.412274</td>
      <td>0.415158</td>
      <td>0.408108</td>
      <td>0.328954</td>
      <td>0.349143</td>
      <td>0.36837</td>
    </tr>
    <tr>
      <th>f1_score</th>
      <td>0.340219</td>
      <td>0.328156</td>
      <td>0.307074</td>
      <td>0.236561</td>
      <td>0.325725</td>
      <td>0.309581</td>
      <td>0.333963</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.3892</td>
      <td>0.412274</td>
      <td>0.415158</td>
      <td>0.408108</td>
      <td>0.328954</td>
      <td>0.349143</td>
      <td>0.36837</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[161]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">LDAModel</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;MODEL:&#39;</span><span class="p">,</span> <span class="n">model</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;The precision for this classifier is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The recall for this classifier is    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The f1 for this classifier is        &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;f1_score&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The accuracy for this classifier is  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;Here is the classification report:&#39;</span>
    <span class="k">print</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;clf_report&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>----------
MODEL: LDA
----------
The precision for this classifier is 0.302586154488
The recall for this classifier is    0.412273674091
The f1 for this classifier is        0.328155703781
The accuracy for this classifier is  0.412273674091
Here is the classification report:
             precision    recall  f1-score   support

          1       0.14      0.01      0.01       390
          2       0.00      0.00      0.00       463
          3       0.00      0.00      0.00       844
          4       0.38      0.27      0.32      1997
          5       0.42      0.79      0.55      2547

avg / total       0.30      0.41      0.33      6241

----------
MODEL: QDA
----------
The precision for this classifier is 0.343105342377
The recall for this classifier is    0.349142765582
The f1 for this classifier is        0.30958114813
The accuracy for this classifier is  0.349142765582
Here is the classification report:
             precision    recall  f1-score   support

          1       0.17      0.30      0.21       390
          2       0.15      0.01      0.02       463
          3       0.19      0.02      0.03       844
          4       0.34      0.63      0.44      1997
          5       0.46      0.31      0.37      2547

avg / total       0.34      0.35      0.31      6241

---------------
MODEL: AdaBoost
---------------
The precision for this classifier is 0.359738608347
The recall for this classifier is    0.389200448646
The f1 for this classifier is        0.340219454347
The accuracy for this classifier is  0.389200448646
Here is the classification report:
             precision    recall  f1-score   support

          1       0.22      0.13      0.16       390
          2       0.16      0.01      0.02       463
          3       0.33      0.00      0.00       844
          4       0.33      0.43      0.37      1997
          5       0.45      0.59      0.51      2547

avg / total       0.36      0.39      0.34      6241

--------------------------
MODEL: Logistic Regression
--------------------------
The precision for this classifier is 0.305603241212
The recall for this classifier is    0.415157827271
The f1 for this classifier is        0.307073744521
The accuracy for this classifier is  0.415157827271
Here is the classification report:
             precision    recall  f1-score   support

          1       0.00      0.00      0.00       390
          2       0.00      0.00      0.00       463
          3       0.00      0.00      0.00       844
          4       0.43      0.17      0.24      1997
          5       0.41      0.89      0.56      2547

avg / total       0.31      0.42      0.31      6241

--------------------
MODEL: Random Forest
--------------------
The precision for this classifier is 0.329963535816
The recall for this classifier is    0.368370453453
The f1 for this classifier is        0.33396296783
The accuracy for this classifier is  0.368370453453
Here is the classification report:
             precision    recall  f1-score   support

          1       0.29      0.07      0.12       390
          2       0.12      0.02      0.03       463
          3       0.15      0.05      0.07       844
          4       0.32      0.46      0.38      1997
          5       0.44      0.51      0.47      2547

avg / total       0.33      0.37      0.33      6241

------------------------
MODEL: Nearest Neighbors
------------------------
The precision for this classifier is 0.325766564949
The recall for this classifier is    0.328953693318
The f1 for this classifier is        0.325724866361
The accuracy for this classifier is  0.328953693318
Here is the classification report:
             precision    recall  f1-score   support

          1       0.14      0.13      0.13       390
          2       0.11      0.08      0.09       463
          3       0.14      0.13      0.13       844
          4       0.33      0.40      0.37      1997
          5       0.45      0.41      0.43      2547

avg / total       0.33      0.33      0.33      6241

------------------------------
MODEL: Multinomial Naive Bayes
------------------------------
The precision for this classifier is 0.166551874436
The recall for this classifier is    0.408107675052
The f1 for this classifier is        0.236561276367
The accuracy for this classifier is  0.408107675052
Here is the classification report:
             precision    recall  f1-score   support

          1       0.00      0.00      0.00       390
          2       0.00      0.00      0.00       463
          3       0.00      0.00      0.00       844
          4       0.00      0.00      0.00      1997
          5       0.41      1.00      0.58      2547

avg / total       0.17      0.41      0.24      6241

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[162]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">LDAModel</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;y_predicted&#39;</span><span class="p">]</span>
    
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">])</span>
    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TFIDF_Y_test</span>

    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">rating</span> <span class="o">-</span> <span class="n">test_df</span><span class="o">.</span><span class="n">predicted_rating</span>
    <span class="n">plot_error_dist</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is not giving expected accuracy because some topics, though they seem similar have different sentiments. So adding a sentimnt layer.
Sentiment Column is added using Logistic Regression</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[163]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">sentiment_X_train</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">star_train</span><span class="p">)</span>
<span class="n">sentiment_X_test</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">star_test</span><span class="p">)</span>

<span class="n">sentiment_Y_train</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Sentiment&#39;</span><span class="p">]</span>
<span class="n">sentiment_Y_test</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Sentiment&#39;</span><span class="p">]</span>

<span class="n">senti_classifier</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sentiment_X_train</span><span class="p">,</span> <span class="n">sentiment_Y_train</span><span class="p">)</span>

<span class="n">ySentimentTrain</span> <span class="o">=</span> <span class="n">senti_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentiment_X_train</span><span class="p">)</span>
<span class="n">ySentimentTest</span> <span class="o">=</span> <span class="n">senti_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentiment_X_test</span><span class="p">)</span>

<span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Sentiment_Predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ySentimentTrain</span>
<span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Sentiment_Predicted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ySentimentTest</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[164]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">MultinomialNB</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">()]</span>
<span class="n">clf_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nearest Neighbors&#39;</span><span class="p">,</span> <span class="s1">&#39;Multinomial Naive Bayes&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">]</span>

<span class="n">SentimentResults</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">clf_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clfs</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">clf_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sentiment_X_train</span><span class="p">,</span> <span class="n">sentiment_Y_train</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentiment_X_test</span><span class="p">)</span>
    
    <span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">sentiment_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">sentiment_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">sentiment_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">sentiment_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">sentiment_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">sentiment_Y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">SG</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="n">precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span><span class="n">accuracy</span><span class="p">,</span>
            <span class="s1">&#39;clf_report&#39;</span><span class="p">:</span><span class="n">report</span><span class="p">,</span>
            <span class="s1">&#39;clf_matrix&#39;</span><span class="p">:</span><span class="n">matrix</span><span class="p">,</span>
            <span class="s1">&#39;y_predicted&#39;</span><span class="p">:</span><span class="n">preds</span><span class="p">}</span>
    
    <span class="n">SentimentResults</span><span class="p">[</span><span class="n">clf_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>
    
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_score&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">SentimentResults</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[164]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Logistic Regression</th>
      <th>Multinomial Naive Bayes</th>
      <th>Nearest Neighbors</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>precision</th>
      <td>0.892191</td>
      <td>0.771798</td>
      <td>0.780613</td>
    </tr>
    <tr>
      <th>recall</th>
      <td>0.957967</td>
      <td>0.997359</td>
      <td>0.96941</td>
    </tr>
    <tr>
      <th>f1_score</th>
      <td>0.92391</td>
      <td>0.8702</td>
      <td>0.864828</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.885115</td>
      <td>0.783368</td>
      <td>0.779362</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[165]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">SentimentResults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;MODEL:&#39;</span><span class="p">,</span> <span class="n">model</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;The precision for this classifier is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The recall for this classifier is    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The f1 for this classifier is        &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;f1_score&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The accuracy for this classifier is  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;Here is the classification report:&#39;</span>
    <span class="k">print</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;clf_report&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>--------------------------
MODEL: Logistic Regression
--------------------------
The precision for this classifier is 0.892191022751
The recall for this classifier is    0.957966549296
The f1 for this classifier is        0.923909582935
The accuracy for this classifier is  0.885114564974
Here is the classification report:
             precision    recall  f1-score   support

          0       0.86      0.69      0.77      1697
          1       0.89      0.96      0.92      4544

avg / total       0.88      0.89      0.88      6241

------------------------
MODEL: Nearest Neighbors
------------------------
The precision for this classifier is 0.780613149034
The recall for this classifier is    0.969410211268
The f1 for this classifier is        0.864827721606
The accuracy for this classifier is  0.779362281686
Here is the classification report:
             precision    recall  f1-score   support

          0       0.77      0.27      0.40      1697
          1       0.78      0.97      0.86      4544

avg / total       0.78      0.78      0.74      6241

------------------------------
MODEL: Multinomial Naive Bayes
------------------------------
The precision for this classifier is 0.771798365123
The recall for this classifier is    0.99735915493
The f1 for this classifier is        0.87019969278
The accuracy for this classifier is  0.783368049992
Here is the classification report:
             precision    recall  f1-score   support

          0       0.97      0.21      0.35      1697
          1       0.77      1.00      0.87      4544

avg / total       0.83      0.78      0.73      6241

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[166]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">SentimentResults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;y_predicted&#39;</span><span class="p">]</span>
    
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_predicted</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">])</span>
    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TFIDF_Y_test</span>

    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">rating</span> <span class="o">-</span> <span class="n">test_df</span><span class="o">.</span><span class="n">predicted_rating</span>
    <span class="n">plot_error_dist</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>LDA + Sentiment Model</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[183]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">topics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">topicDist_allStars_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="n">numTopics</span><span class="p">])</span>
<span class="n">topics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topicDist_allStars_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">numTopics</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span> <span class="n">topics</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;Topic1&#39;, &#39;Topic2&#39;, &#39;Topic3&#39;, &#39;Topic4&#39;, &#39;Topic5&#39;, &#39;Topic6&#39;, &#39;Topic7&#39;, &#39;Topic8&#39;, &#39;Topic9&#39;, &#39;Topic10&#39;, &#39;Topic11&#39;, &#39;Topic12&#39;, &#39;Topic13&#39;, &#39;Topic14&#39;, &#39;Topic15&#39;, &#39;Sentiment_Predicted&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[186]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="n">topics</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">topicDist_allStars_train</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span>

<span class="n">x_test</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="n">topics</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">topicDist_allStars_test</span><span class="p">[</span><span class="s1">&#39;Star&#39;</span><span class="p">]</span> 

<span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">MultinomialNB</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">LDA</span><span class="p">(),</span> <span class="n">QDA</span><span class="p">(),</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">clf_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nearest Neighbors&#39;</span><span class="p">,</span> <span class="s1">&#39;Multinomial Naive Bayes&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;LDA&#39;</span><span class="p">,</span> <span class="s1">&#39;QDA&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;AdaBoost&#39;</span><span class="p">]</span>

<span class="n">FinalResults</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">clf_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clfs</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">clf_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
    
    <span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">SG</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="n">precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span><span class="n">accuracy</span><span class="p">,</span>
            <span class="s1">&#39;clf_report&#39;</span><span class="p">:</span><span class="n">report</span><span class="p">,</span>
            <span class="s1">&#39;clf_matrix&#39;</span><span class="p">:</span><span class="n">matrix</span><span class="p">,</span>
            <span class="s1">&#39;y_predicted&#39;</span><span class="p">:</span><span class="n">preds</span><span class="p">}</span>
    
    <span class="n">FinalResults</span><span class="p">[</span><span class="n">clf_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_score&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">FinalResults</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[186]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AdaBoost</th>
      <th>LDA</th>
      <th>Logistic Regression</th>
      <th>Multinomial Naive Bayes</th>
      <th>Nearest Neighbors</th>
      <th>QDA</th>
      <th>Random Forest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>precision</th>
      <td>0.445903</td>
      <td>0.5371</td>
      <td>0.466422</td>
      <td>0.166552</td>
      <td>0.421295</td>
      <td>0.460697</td>
      <td>0.432767</td>
    </tr>
    <tr>
      <th>recall</th>
      <td>0.456337</td>
      <td>0.467553</td>
      <td>0.48598</td>
      <td>0.408108</td>
      <td>0.422208</td>
      <td>0.482134</td>
      <td>0.43727</td>
    </tr>
    <tr>
      <th>f1_score</th>
      <td>0.448045</td>
      <td>0.409387</td>
      <td>0.404169</td>
      <td>0.236561</td>
      <td>0.420159</td>
      <td>0.440121</td>
      <td>0.433552</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.456337</td>
      <td>0.467553</td>
      <td>0.48598</td>
      <td>0.408108</td>
      <td>0.422208</td>
      <td>0.482134</td>
      <td>0.43727</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[187]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">FinalResults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;MODEL:&#39;</span><span class="p">,</span> <span class="n">model</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;The precision for this classifier is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The recall for this classifier is    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The f1 for this classifier is        &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;f1_score&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The accuracy for this classifier is  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;Here is the classification report:&#39;</span>
    <span class="k">print</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;clf_report&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>----------
MODEL: LDA
----------
The precision for this classifier is 0.537099892693
The recall for this classifier is    0.467553276718
The f1 for this classifier is        0.40938663148
The accuracy for this classifier is  0.467553276718
Here is the classification report:
             precision    recall  f1-score   support

          1       0.37      0.36      0.37       390
          2       0.27      0.57      0.37       463
          3       1.00      0.00      0.00       844
          4       0.44      0.23      0.30      1997
          5       0.53      0.81      0.64      2547

avg / total       0.54      0.47      0.41      6241

----------
MODEL: QDA
----------
The precision for this classifier is 0.460697334267
The recall for this classifier is    0.482134273354
The f1 for this classifier is        0.440120970581
The accuracy for this classifier is  0.482134273354
Here is the classification report:
             precision    recall  f1-score   support

          1       0.36      0.56      0.43       390
          2       0.34      0.28      0.31       463
          3       0.41      0.19      0.26       844
          4       0.43      0.21      0.29      1997
          5       0.53      0.82      0.65      2547

avg / total       0.46      0.48      0.44      6241

---------------
MODEL: AdaBoost
---------------
The precision for this classifier is 0.445902958008
The recall for this classifier is    0.456337125461
The f1 for this classifier is        0.448045168541
The accuracy for this classifier is  0.456337125461
Here is the classification report:
             precision    recall  f1-score   support

          1       0.34      0.36      0.35       390
          2       0.33      0.22      0.27       463
          3       0.39      0.29      0.34       844
          4       0.40      0.39      0.39      1997
          5       0.54      0.62      0.58      2547

avg / total       0.45      0.46      0.45      6241

--------------------------
MODEL: Logistic Regression
--------------------------
The precision for this classifier is 0.466422169072
The recall for this classifier is    0.485979810928
The f1 for this classifier is        0.404168556809
The accuracy for this classifier is  0.485979810928
Here is the classification report:
             precision    recall  f1-score   support

          1       0.43      0.26      0.32       390
          2       0.32      0.04      0.07       463
          3       0.36      0.45      0.40       844
          4       0.48      0.10      0.17      1997
          5       0.52      0.91      0.66      2547

avg / total       0.47      0.49      0.40      6241

--------------------
MODEL: Random Forest
--------------------
The precision for this classifier is 0.432766608304
The recall for this classifier is    0.437269668322
The f1 for this classifier is        0.433551991185
The accuracy for this classifier is  0.437269668322
Here is the classification report:
             precision    recall  f1-score   support

          1       0.35      0.33      0.34       390
          2       0.29      0.23      0.26       463
          3       0.36      0.28      0.31       844
          4       0.38      0.43      0.40      1997
          5       0.53      0.55      0.54      2547

avg / total       0.43      0.44      0.43      6241

------------------------
MODEL: Nearest Neighbors
------------------------
The precision for this classifier is 0.421295343033
The recall for this classifier is    0.42220797949
The f1 for this classifier is        0.420158613693
The accuracy for this classifier is  0.42220797949
Here is the classification report:
             precision    recall  f1-score   support

          1       0.31      0.40      0.35       390
          2       0.28      0.26      0.27       463
          3       0.27      0.20      0.23       844
          4       0.39      0.44      0.42      1997
          5       0.54      0.51      0.53      2547

avg / total       0.42      0.42      0.42      6241

------------------------------
MODEL: Multinomial Naive Bayes
------------------------------
The precision for this classifier is 0.166551874436
The recall for this classifier is    0.408107675052
The f1 for this classifier is        0.236561276367
The accuracy for this classifier is  0.408107675052
Here is the classification report:
             precision    recall  f1-score   support

          1       0.00      0.00      0.00       390
          2       0.00      0.00      0.00       463
          3       0.00      0.00      0.00       844
          4       0.00      0.00      0.00      1997
          5       0.41      1.00      0.58      2547

avg / total       0.17      0.41      0.24      6241

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Error Metrics</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[188]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># Train Data</span>
<span class="n">data_1stars_train</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star1_train</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">stars1_labels_train</span><span class="p">}</span>
<span class="n">data_1stars_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_1stars_train</span><span class="p">)</span>

<span class="n">data_2stars_train</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star2_train</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">stars2_labels_train</span><span class="p">}</span>
<span class="n">data_2stars_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_2stars_train</span><span class="p">)</span>

<span class="n">data_3stars_train</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star3_train</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">stars3_labels_train</span><span class="p">}</span>
<span class="n">data_3stars_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_3stars_train</span><span class="p">)</span>

<span class="n">data_4stars_train</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star4_train</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">stars4_labels_train</span><span class="p">}</span>
<span class="n">data_4stars_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_4stars_train</span><span class="p">)</span>

<span class="n">data_5stars_train</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star5_train</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">stars5_labels_train</span><span class="p">}</span>
<span class="n">data_5stars_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_5stars_train</span><span class="p">)</span>

<span class="c1"># Test Data</span>
<span class="n">data_1stars_test</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star1_test</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">star1_labels_test</span><span class="p">}</span>
<span class="n">data_1stars_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_1stars_test</span><span class="p">)</span>

<span class="n">data_2stars_test</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star2_test</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">star2_labels_test</span><span class="p">}</span>
<span class="n">data_2stars_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_2stars_test</span><span class="p">)</span>

<span class="n">data_3stars_test</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star3_test</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">star3_labels_test</span><span class="p">}</span>
<span class="n">data_3stars_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_3stars_test</span><span class="p">)</span>

<span class="n">data_4stars_test</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star4_test</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">star4_labels_test</span><span class="p">}</span>
<span class="n">data_4stars_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_4stars_test</span><span class="p">)</span>

<span class="n">data_5stars_test</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">star5_test</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">star5_labels_test</span><span class="p">}</span>
<span class="n">data_5stars_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_5stars_test</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[189]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">train_pieces</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_1stars_train</span><span class="p">,</span> <span class="n">data_2stars_train</span><span class="p">,</span> <span class="n">data_3stars_train</span><span class="p">,</span> <span class="n">data_4stars_train</span><span class="p">,</span> <span class="n">data_5stars_train</span><span class="p">]</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">train_pieces</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="s1">&#39;training_data&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">train_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Train Data&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>

<span class="n">test_pieces</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_1stars_test</span><span class="p">,</span> <span class="n">data_2stars_test</span><span class="p">,</span> <span class="n">data_3stars_test</span><span class="p">,</span> <span class="n">data_4stars_test</span><span class="p">,</span> <span class="n">data_5stars_test</span><span class="p">]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">test_pieces</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Test Data&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Train Data 24951
Test Data 6241
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[190]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">FinalResults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">y_predicted</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;y_predicted&#39;</span><span class="p">]</span>
    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_predicted</span><span class="p">)</span>
    <span class="n">pieces</span> <span class="o">=</span> <span class="p">[</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">]</span>
    <span class="n">all_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pieces</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">rating</span> <span class="o">-</span> <span class="n">test_df</span><span class="o">.</span><span class="n">predicted_rating</span>
    <span class="n">plot_error_dist</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[192]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">trainDF</span> <span class="o">=</span> <span class="n">restaurantsDF</span>
<span class="n">trainLabel</span> <span class="o">=</span> <span class="n">trainDF</span><span class="o">.</span><span class="n">stars_review</span>
<span class="n">trainDocuments</span> <span class="o">=</span> <span class="n">trainDF</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[195]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[196]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">trainVectors</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">trainDocuments</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[197]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[198]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">vocab</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[198]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>array([u&#39;00&#39;, u&#39;000&#39;, u&#39;00am&#39;, u&#39;00pm&#39;, u&#39;03&#39;, u&#39;04&#39;, u&#39;05&#39;, u&#39;06&#39;, u&#39;07&#39;,
       u&#39;08&#39;, u&#39;09&#39;, u&#39;10&#39;, u&#39;100&#39;, u&#39;1000&#39;, u&#39;101&#39;, u&#39;1030&#39;, u&#39;105&#39;,
       u&#39;10am&#39;, u&#39;10min&#39;, u&#39;10mins&#39;, u&#39;10oz&#39;, u&#39;10pm&#39;, u&#39;10th&#39;, u&#39;10x&#39;,
       u&#39;11&#39;, u&#39;110&#39;, u&#39;1100&#39;, u&#39;115&#39;, u&#39;11am&#39;, u&#39;11pm&#39;, u&#39;12&#39;, u&#39;120&#39;,
       u&#39;1200&#39;, u&#39;1230&#39;, u&#39;125&#39;, u&#39;12oz&#39;, u&#39;12pm&#39;, u&#39;13&#39;, u&#39;130&#39;, u&#39;14&#39;,
       u&#39;140&#39;, u&#39;1400&#39;, u&#39;144&#39;, u&#39;14oz&#39;, u&#39;15&#39;, u&#39;150&#39;, u&#39;1500&#39;, u&#39;15am&#39;,
       u&#39;15min&#39;, u&#39;15mins&#39;], 
      dtype=&#39;&lt;U18&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[199]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">trainVectors</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[199]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(31192L, 13080L)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[200]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[200]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>13080</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By analogy with LDA, using NMF to get a document-topic matrix (topics here will also be referred to as “components”) and a list of top words for each topic. Making analogy clear by using the same variable names: doctopic and topic_words</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[201]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">num_topics</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">num_top_words</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[202]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">NMF</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">num_topics</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[203]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">trainTopics</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">trainVectors</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Scaling the document matrix such that the component values associated with each document sum to one for analysis and visualization of NFM components similar to that of LDA&#39;s topic proportions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[204]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">trainTopics</span> <span class="o">=</span> <span class="n">trainTopics</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">trainTopics</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>averaging topic shares associated with the same document together.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[209]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">D</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">trainTopics</span><span class="o">.</span><span class="n">shape</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Topic&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">NMFdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trainTopics</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[210]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">NMFdf</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trainLabel</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[211]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">NMFdf</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[211]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>31182</th>
      <th>31183</th>
      <th>31184</th>
      <th>31185</th>
      <th>31186</th>
      <th>31187</th>
      <th>31188</th>
      <th>31189</th>
      <th>31190</th>
      <th>31191</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Topic1</th>
      <td>0.132350</td>
      <td>0.183134</td>
      <td>0.152206</td>
      <td>0.002956</td>
      <td>0.093372</td>
      <td>0.208299</td>
      <td>0.150239</td>
      <td>0.280760</td>
      <td>0.000000</td>
      <td>0.275726</td>
      <td>...</td>
      <td>0.117990</td>
      <td>0.000000</td>
      <td>0.172771</td>
      <td>0.196761</td>
      <td>0.001829</td>
      <td>0.006129</td>
      <td>0.177766</td>
      <td>0.006523</td>
      <td>0.324109</td>
      <td>0.132226</td>
    </tr>
    <tr>
      <th>Topic2</th>
      <td>0.006297</td>
      <td>0.268206</td>
      <td>0.005574</td>
      <td>0.000000</td>
      <td>0.131210</td>
      <td>0.008077</td>
      <td>0.000000</td>
      <td>0.202202</td>
      <td>0.109022</td>
      <td>0.008345</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.005668</td>
      <td>0.000000</td>
      <td>0.002964</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.528777</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.193891</td>
    </tr>
    <tr>
      <th>Topic3</th>
      <td>0.000000</td>
      <td>0.247330</td>
      <td>0.200480</td>
      <td>0.006726</td>
      <td>0.117971</td>
      <td>0.140778</td>
      <td>0.203862</td>
      <td>0.007190</td>
      <td>0.102566</td>
      <td>0.018771</td>
      <td>...</td>
      <td>0.164513</td>
      <td>0.012205</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.002128</td>
      <td>0.177376</td>
      <td>0.000000</td>
      <td>0.007094</td>
      <td>0.000000</td>
      <td>0.177201</td>
    </tr>
    <tr>
      <th>Topic4</th>
      <td>0.163733</td>
      <td>0.000000</td>
      <td>0.184946</td>
      <td>0.149700</td>
      <td>0.333348</td>
      <td>0.129576</td>
      <td>0.382207</td>
      <td>0.341828</td>
      <td>0.101163</td>
      <td>0.035684</td>
      <td>...</td>
      <td>0.143596</td>
      <td>0.007872</td>
      <td>0.000870</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.005241</td>
      <td>0.000000</td>
      <td>0.387243</td>
      <td>0.165108</td>
    </tr>
    <tr>
      <th>Topic5</th>
      <td>0.177050</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.005981</td>
      <td>0.000445</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.026477</td>
      <td>0.017515</td>
      <td>0.005420</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.068501</td>
    </tr>
  </tbody>
</table>
<p>5 rows &#215; 31192 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[212]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">getSentiment</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">3.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[213]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">NMFdf</span><span class="p">[</span><span class="s1">&#39;Sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NMFdf</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">getSentiment</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[216]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">nmfDF</span> <span class="o">=</span> <span class="n">NMFdf</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[217]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.lda</span> <span class="kn">import</span> <span class="n">LDA</span>
<span class="kn">from</span> <span class="nn">sklearn.qda</span> <span class="kn">import</span> <span class="n">QDA</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">AdaBoostClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[218]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">u&#39;Topic1&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic2&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic3&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic4&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic5&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic6&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic7&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic8&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic9&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic10&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic11&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic12&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic13&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic14&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic15&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic16&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic17&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic18&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic19&#39;</span><span class="p">,</span> <span class="s1">u&#39;Topic20&#39;</span><span class="p">,</span> <span class="s1">u&#39;Sentiment&#39;</span><span class="p">]</span>
<span class="n">Xtrain</span> <span class="o">=</span> <span class="n">nmfDF</span><span class="p">[:</span><span class="mi">10000</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span>
<span class="n">Ytrain</span> <span class="o">=</span> <span class="n">nmfDF</span><span class="p">[:</span><span class="mi">10000</span><span class="p">][</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span>
<span class="n">Xtest</span> <span class="o">=</span> <span class="n">nmfDF</span><span class="p">[</span><span class="mi">10000</span><span class="p">:][</span><span class="n">cols</span><span class="p">]</span>
<span class="n">Ytest</span> <span class="o">=</span> <span class="n">nmfDF</span><span class="p">[</span><span class="mi">10000</span><span class="p">:][</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[219]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">MultinomialNB</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">LDA</span><span class="p">(),</span> <span class="n">QDA</span><span class="p">(),</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">clf_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nearest Neighbors&#39;</span><span class="p">,</span> <span class="s1">&#39;Multinomial Naive Bayes&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;LDA&#39;</span><span class="p">,</span> <span class="s1">&#39;QDA&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;AdaBoost&#39;</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">clf_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clfs</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">clf_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span> <span class="n">Ytrain</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
    
    <span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">Ytest</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="n">precision</span><span class="p">,</span>
            <span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="n">recall</span><span class="p">,</span>
            <span class="s1">&#39;f1_score&#39;</span><span class="p">:</span><span class="n">f1</span><span class="p">,</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span><span class="n">accuracy</span><span class="p">,</span>
            <span class="s1">&#39;clf_report&#39;</span><span class="p">:</span><span class="n">report</span><span class="p">,</span>
            <span class="s1">&#39;clf_matrix&#39;</span><span class="p">:</span><span class="n">matrix</span><span class="p">,</span>
            <span class="s1">&#39;y_predicted&#39;</span><span class="p">:</span><span class="n">preds</span><span class="p">}</span>
    
    <span class="n">results</span><span class="p">[</span><span class="n">clf_names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s1">&#39;f1_score&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[219]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AdaBoost</th>
      <th>LDA</th>
      <th>Logistic Regression</th>
      <th>Multinomial Naive Bayes</th>
      <th>Nearest Neighbors</th>
      <th>QDA</th>
      <th>Random Forest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>precision</th>
      <td>0.591026</td>
      <td>0.430413</td>
      <td>0.591479</td>
      <td>0.388194</td>
      <td>0.546999</td>
      <td>0.00401651</td>
      <td>0.606388</td>
    </tr>
    <tr>
      <th>recall</th>
      <td>0.603322</td>
      <td>0.460526</td>
      <td>0.610118</td>
      <td>0.430985</td>
      <td>0.546977</td>
      <td>0.063376</td>
      <td>0.620358</td>
    </tr>
    <tr>
      <th>f1_score</th>
      <td>0.591818</td>
      <td>0.432728</td>
      <td>0.586004</td>
      <td>0.306649</td>
      <td>0.545579</td>
      <td>0.00755427</td>
      <td>0.606089</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.603322</td>
      <td>0.460526</td>
      <td>0.610118</td>
      <td>0.430985</td>
      <td>0.546977</td>
      <td>0.063376</td>
      <td>0.620358</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[220]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;MODEL:&#39;</span><span class="p">,</span> <span class="n">model</span>
    <span class="k">print</span> <span class="s1">&#39;-------&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;The precision for this classifier is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The recall for this classifier is    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The f1 for this classifier is        &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;f1_score&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;The accuracy for this classifier is  &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="s1">&#39;Here is the classification report:&#39;</span>
    <span class="k">print</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;clf_report&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>----------
MODEL: LDA
----------
The precision for this classifier is 0.430413438683
The recall for this classifier is    0.46052569487
The f1 for this classifier is        0.432727711395
The accuracy for this classifier is  0.46052569487
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.19      0.28      0.22      1343
        2.0       0.22      0.08      0.12      1619
        3.0       0.28      0.09      0.13      2919
        4.0       0.42      0.44      0.43      6721
        5.0       0.57      0.70      0.63      8589

avg / total       0.43      0.46      0.43     21191

----------
MODEL: QDA
----------
The precision for this classifier is 0.00401651249517
The recall for this classifier is    0.0633759614931
The f1 for this classifier is        0.00755426611212
The accuracy for this classifier is  0.0633759614931
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.06      1.00      0.12      1343
        2.0       0.00      0.00      0.00      1619
        3.0       0.00      0.00      0.00      2919
        4.0       0.00      0.00      0.00      6721
        5.0       0.00      0.00      0.00      8589

avg / total       0.00      0.06      0.01     21191

---------------
MODEL: AdaBoost
---------------
The precision for this classifier is 0.591026314267
The recall for this classifier is    0.60332216507
The f1 for this classifier is        0.591817723332
The accuracy for this classifier is  0.60332216507
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.43      0.48      0.45      1343
        2.0       0.33      0.16      0.22      1619
        3.0       0.61      0.75      0.67      2919
        4.0       0.60      0.51      0.55      6721
        5.0       0.65      0.73      0.69      8589

avg / total       0.59      0.60      0.59     21191

--------------------------
MODEL: Logistic Regression
--------------------------
The precision for this classifier is 0.591479137611
The recall for this classifier is    0.610117502713
The f1 for this classifier is        0.586004058261
The accuracy for this classifier is  0.610117502713
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.40      0.37      0.38      1343
        2.0       0.30      0.06      0.11      1619
        3.0       0.56      0.83      0.67      2919
        4.0       0.63      0.48      0.54      6721
        5.0       0.66      0.78      0.71      8589

avg / total       0.59      0.61      0.59     21191

--------------------
MODEL: Random Forest
--------------------
The precision for this classifier is 0.606387726436
The recall for this classifier is    0.620357699023
The f1 for this classifier is        0.606088639568
The accuracy for this classifier is  0.620357699023
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.48      0.39      0.43      1343
        2.0       0.34      0.15      0.21      1619
        3.0       0.59      0.82      0.68      2919
        4.0       0.62      0.54      0.58      6721
        5.0       0.67      0.74      0.70      8589

avg / total       0.61      0.62      0.61     21191

------------------------
MODEL: Nearest Neighbors
------------------------
The precision for this classifier is 0.546998624322
The recall for this classifier is    0.546977490444
The f1 for this classifier is        0.545578528675
The accuracy for this classifier is  0.546977490444
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.32      0.43      0.37      1343
        2.0       0.30      0.26      0.28      1619
        3.0       0.58      0.54      0.56      2919
        4.0       0.54      0.49      0.51      6721
        5.0       0.63      0.67      0.65      8589

avg / total       0.55      0.55      0.55     21191

------------------------------
MODEL: Multinomial Naive Bayes
------------------------------
The precision for this classifier is 0.388194070559
The recall for this classifier is    0.43098485206
The f1 for this classifier is        0.306648753615
The accuracy for this classifier is  0.43098485206
Here is the classification report:
             precision    recall  f1-score   support

        1.0       0.00      0.00      0.00      1343
        2.0       0.00      0.00      0.00      1619
        3.0       0.49      0.03      0.05      2919
        4.0       0.46      0.12      0.19      6721
        5.0       0.43      0.96      0.59      8589

avg / total       0.39      0.43      0.31     21191

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[221]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">Xtest</span><span class="p">[</span><span class="s1">&#39;predicted_rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;y_predicted&#39;</span><span class="p">]</span>
    <span class="n">Xtest</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ytest</span>
    <span class="n">Xtest</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Xtest</span><span class="o">.</span><span class="n">rating</span> <span class="o">-</span> <span class="n">Xtest</span><span class="o">.</span><span class="n">predicted_rating</span>
    <span class="n">plot_error_dist</span><span class="p">(</span><span class="n">Xtest</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

<div class="output_area"><div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[&#160;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>


<script type="text/javascript" src="/d2l/common/math/MathML.js?v=10.7.3.7486-324 "></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() { D2LMathML.DesktopInit('https://s.brightspace.com/lib/mathjax/2.6.1/MathJax.js?config=MML_HTMLorMML','https://s.brightspace.com/lib/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'); });</script></body></html>